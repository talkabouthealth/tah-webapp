#{extends 'main.html' /}
	<link rel='stylesheet' type='text/css' href='/public/stylesheets/styles.css' />
	<style>
		body {
			background:url(/public/images/inner_bgmt.gif) repeat-x top;
			font-size: 14px;
		}
		#innermid {
			padding: 10px;
		}
		
		#reply {
			padding: 10px 0 0 0;
		}
		.commentsarea {
			padding-top: 0px;
		}
		#replytext {
			height: 20px;
			color: #777777;
		}
		.commentreply {
			height: 20px;
			color: #777777;
		}
		
		a {color:#333; text-decoration:none}
		a:hover {color:#ccc; text-decoration:none}
		#mask {
		  position:absolute;
		  left:0;
		  top:0;
		  z-index:9000;
		 
		  display:none;
		}
		  
		#boxes .window {
		  position:absolute;
		  left:0;
		  top:0;
		  width:440px;
		  height:200px;
		  display:none;
		  z-index:9999;
		  padding:20px;
		}
		
		#boxes #dialog {
		  width:375px; 
		  height:203px;
		  padding:10px;
		  background-color:#ffffff;
		}
		
		#boxes #dialog1 {
		  width:685px; height:407px;
		}
		
		#dialog1 .d-header {
		  background:url(/public/images/login-header.png) no-repeat 0 0 transparent; 
		  width:375px; 
		  height:150px;
		}
		
		#dialog1 .d-header input {
		  position:relative;
		  top:60px;
		  left:100px;
		  border:3px solid #cccccc;
		  height:22px;
		  width:200px;
		  font-size:15px;
		  padding:5px;
		  margin-top:4px;
		}
		
		#dialog1 .d-blank {
		  float:left;
		  background:url(/public/images/login-blank.png) no-repeat 0 0 transparent; 
		  width:267px; 
		  height:53px;
		}
		
		#dialog1 .d-login {
		  float:left;
		  width:108px; 
		  height:53px;
		}
		
		#boxes #dialog2 {
		  background:url(/public/images/notice.png) no-repeat 0 0 transparent; 
		  width:326px; 
		  height:229px;
		  padding:50px 0 20px 25px;
		}
		.style2 {color: #000000}
		.display {
			background:#FFF;
			width:1px;
			height:1px;
			margin-left:3px;
		}
		
		/* Different fixes */
	</style>

	<script type="text/javascript" 
		src="/public/plugins/jquery.inline-edit.js" ></script>
	<script type="text/javascript">
		var tid = '${convo.tid}';
		$(document).ready(function() {
			$("#followConvoLink").click(function() {
				$.post("@{Conversations.follow()}", 
	  				{ topicId: '${convo.id}'},
	  				function(data) {
	  					if ($("#followConvoLink").html() == "Follow Conversation") {
	  						$("#followConvoLink").html("Unfollow Conversation");
	  					}
	  					else {
	  						$("#followConvoLink").html("Follow Conversation");
	  					}
	  				}
	  			);
			});

			$(".restartConvoLink").click(function() {
				openChat(tid);
				$.post("@{Conversations.restart}", {topicId: '${convo.id}'});
			});

			$(".flagConvoLink").click(function() {
				$(this).after("<span>Thanks!</span>").detach();
				$.post("@{Conversations.flag}", {topicId: '${convo.id}'});
			});

			//----- Comments ------
			$(".commentreply").each(function() {
				$(this).val("Reply to comment..").css("color", "#777777");
			});

   			$("#replytext")
	   			.click(function() {
		   			updateCommentState('Extended');
	   			})
	   			.blur(function() {
		   			if ($(this).val() == "") {
		   				updateCommentState('Initial');
		   			}
	   			});
	
	   		$(".commentreply")
	   			.click(function() {
	   				updateReplyState($(this), 'Extended');
	   			})
	   			.blur(function() {
		   			if ($(this).val() == "") {
		   				updateReplyState($(this), 'Initial');
		   			}
	   			});		

			$(".votebtn").live("click", function() {
	   				var value = $(this).val();
	   				var answerId = $(this).attr("rel");

	   				$.post("@{Conversations.vote}", 
	   		   				{ answerId : answerId, up : value }
		   				);
	   			});
	   		

   			//------- Edits ----------
   			$("#titleBtn").click(function() {
   	   			var newValue = $("#titleinput").val();
   	   			$("#convoTitle").html(newValue);
   	   			//hide edit
   	   			shoit('1');
   	   			$("#hidit1 .display").show();
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'title', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	

   			$("#detailsBtn").click(function() {
   	   			var newValue = $("#detailsinput").val();
   	   			$("#convoDetails").html(newValue === '' ? 'Add details...' : newValue);
	   			//hide edit
	   			shoit('2');
	   			$("#hidit2 .display").show();
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'details', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	

   			$("#summaryBtn").click(function() {
   	   			var newValue = $("#summaryinput").val();
	   	   		$("#convoSummary").html(newValue === '' ? 'Add summary...' : newValue);
	   			//hide edit
	   			shoit('13');
	   			$("#hidit13 .display").show();
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'summary', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	


   			/* New Design */
   			$('.inline-edit').inlineEdit({hover: 'hover'})
		});

		function updateCommentState(newState) {
   	   		if (newState == 'Initial') {
   	   			$("#replytext").val("What are you thinking?").css("color", "#777777");
				$("#commentBtn").hide();
   	   		}
   	   		else if (newState == 'Extended') {
	   	   		$("#replytext").val("").css("color", "#000000");
	   			$("#commentBtn").show();
   	   		}
   		}

   		function updateReplyState(replyTextArea, newState) {
   	   		if (newState == 'Initial') {
   	   			replyTextArea.val("Reply to comment..").css("color", "#777777");
   	   			replyTextArea.parent().next().hide();
   	   		}
   	   		else if (newState == 'Extended') {
   	   			replyTextArea.val("").css("color", "#000000");
	   			replyTextArea.parent().next().show();
   	   		}
   		}

   		//public static void saveTopicComment(String topicId, String parentId, String text) {
   		function saveProfileComment(parentId) {
   	   		var commentText = $("#replytext"+parentId).val();
   			$("#replytext"+parentId).val("");

   			$.post("@{Conversations.saveTopicComment()}", 
  				{ topicId: '${convo.id}', parentId: parentId, text: commentText},
  				function(html) {
  	  				$("#firstcommentmessage").hide();
  					//put comment in the tree
  					if (parentId == '') {
  	  					//add as first element in the top
  						$(html).prependTo($(".commentsarea"));
  					}
  					else {
  						//add as last element in subtree
  						$("#reply"+parentId).before($(html));
  					}
  				}
  			);

   			if (parentId == '') {
   				updateCommentState('Initial');
			}
			else {
				updateReplyState($("#replytext"+parentId), 'Initial');
			}
  			return false;
   		}

		/* Awful, TODO: fix them */
	    function hidit(id) {
	    	var e = document.getElementById('hidit'+id);
	    	e.style.display = 'none';
			return false;
	    }
		function shoit(id)
		{
		  var e = document.getElementById('editit'+id);
	          e.style.display = 'none';
			  var e = document.getElementById('hidit'+id);
	         e.style.display = 'block';
	         return false;
		}
	</script>
</head>

<body>
<div id="top_container">
	<div id="top">
		#{ logo /}
		<div id="topnav">
			#{include 'menu.html' /}
		</div>
	</div>
</div>

<div id="innerbanner"></div>
<div id="bottom_container">

	<div id="targetedtherapy">
		<div id="innermiddlearea">
			<div id="mtcover">
				<div id="mtleft">
					<div class="mtcontent">
						<div id="targetedtherapy">
							<div class="suggescover">
								<div class="editsWraper">
									<div class="editsWraper">
										<div class='inline-edit'>
											<div id="hidit1">
												<div id="convoTitle" class="targetedh7" style="display:block;">${convo.topic}</div>
												<div class="display" style="display:block;">
													<div class="editit" style="display:block;">
														<a href="#" onclick="hidit('1')">Edit</a>
													</div>
												</div>
										    </div>
										    <div style="margin-top:10px; margin-bottom:10px;"></div>
											<div class='form' id="editit1">
												<div style="float:left; width:auto; padding-bottom:5px;" >
										        	<input id="titleinput" type="text"
										        		value="${convo.topic}" class="edititinputs" style="width:600px"  >
										        </div>
												<div style="float:right;margin-right:30px;">
											        <input id="titleBtn" type="submit"  class="updatebtns" value=" " />
											        <div class="canclebtnz">
											        	<a class="cancel" href="#" onclick="shoit('1')">Cancel</a>
											        </div>
												</div>
											</div>
										</div>
									</div>
								</div><!--editsWraper-->
								<div style="clear:both">
									<div class='inline-edit'>
										<div class="suggestxt" id="hidit2">
                      						<p id="convoDetails" style="float:left; padding-top:10px;">
                      							${convo.details ? convo.details : "Add details..."}</p>
                      						<div class='display'>
												<div class="editit" style="padding-top:10px;">
													<a href="#" onclick="hidit('2')">Edit</a>
												</div>
											</div>
                    					</div>
										<div class='form' id="editit2">
											<div style="padding-top:10px;">
										        <textarea id="detailsinput" class="edititinputx" 
										        	style="width:600px">${convo.details}</textarea>
									        </div>
											<div style="float:right;margin-right:30px;">
												<input id="detailsBtn" type="submit" class="updatebtns" value=" " />
												<div class="canclebtnz">
													<a class="cancel" href="#" onclick="shoit('2')">Cancel</a>
												</div>
											</div>
										</div>
									</div>
								</div> <!--Blank-->   
							</div><!--suggescover-->
                  		</div> <!--targetedtherapy-->
                  		<div class="topipcWraper">
                    		<div class="topic">
                      			<div class='inline-edit'>
									<div class="topictxt" id="hidit4" style="display:block; float:left; width:auto;">
									<div style="float:left;">Topics: &nbsp;&nbsp;&nbsp;&nbsp;</div>
									<div class="suuport"><a href="#"></a></div>
									 <div class="Helptag"><a href="#"></a></div> 
									              
									</div>
									<!--topictxt-->
										<div class='display' style="padding-top:10px;"><div class="editit"><a href="javascript:void()"  onclick="hidit('4')">Edit</a></div></div>       
									     <div class='form' style="clear:both; padding-top:5px;" id="editit4">
									     <div class="topictxt" id="hidit4" style="display:block; float:left; width:auto;">
									<div style="float:left;">Topics &nbsp;&nbsp;&nbsp;&nbsp;</div>
									<div class="suuportzz"><a href="#"></a></div>
									 <div class="Helptagzz"><a href="#"></a></div> 
									              
									</div>
											  <div class="addcomCover" style="width:400px;">
									                      <input type="text" class="addcominput"  value="" style="float:left; width:215px;"/>
									                      <input type="submit" value=" " class="addcomsubmit" src="/public//public/images/addcomsubmit.jpg" style="float:left; width:80;"  />
									                      <div class="canclebtnz" style="float:left; width:auto;"><a href="javascript:void()" onclick="shoit('4')">Cancel</a></div> 
									                      </div><!--addcomCover-->
										</div><!--form--> 
								</div>
                      
                      			#{if talker }
									<div class="tagtxts">
				                    	<a href="#" class="restartConvoLink">Restart Conversation </a> |  
				                    	<a href="#">Start Follow up conversation</a>  |  
				                    	<a href="#" class="flagConvoLink">Flag Question </a> 
				                    </div>
								#{/if}
								<div class="cb"></div>
							</div> <!--topic-->
							
                    		<div class="topic">
                    			<div class="cscover">
                    				<div class="cstop">
					                   <div class='inline-edit'>
					 						<div class="cstoptext" id="hidit3">Conversation Summary</div>
										</div>
                    				</div><!--cstop-->
				                    <div class="csmid">
				                    	<div class="cmmidtext">
                     						<div class='inline-edit' style="width: 100%">
                     							<div id="hidit13">
													<div id="convoSummary" style="display:block;padding-right:30px;text-align:justify">
														${convo.summary ? convo.summary : "Add summary..."}
													</div> 
													<div class='display' style="float:right;margin-right:80px;">
														<div class="editit" style="margin-top:7px;">
															<a href="" onclick="hidit('13')">Edit</a>
														</div>
													</div>
												</div>
												<div style="margin-top:10px; margin-bottom:10px; clear: both"></div>
												<div class='form' id="editit13">
													<div style="float:left; width:auto;">
        												<textarea style="width:585px;height:230px;font-size:13px;font-weight:normal" 
        													id="summaryinput" class="edititinputs">${convo.summary}</textarea>
        											</div>
													<div style="float:right; width:auto;margin-right:30px;">
														<input id="summaryBtn" class="updatebtns" value=" " />
														<div class="canclebtnz">
															<a class="cancel" href="javascript:void()" onclick="shoit('13')">Cancel</a>
														</div>
													</div>
												</div>
    										</div>
    										<div style="clear: both; padding-top: 10px;">
    											<span class="blacktext">Contributions By:</span> 
												<span class="blacktext">
													#{list items: convo.sumContributors, as: 'contributor'}
														
														#{ifnot contributor_isLast}
															<a href="#">${contributor.userName}</a>, 
														#{/ifnot}
														#{else}
															<a href="#">${contributor.userName}</a>
														#{/else}
													#{/list}
												</span>
    										</div>
										</div><!--cmmidtext-->
                    				</div><!--csmid-->
                    				<div class="csbot"></div>
                    			</div>
                    		</div><!--topic-->
                    		
                     		<div class="topic">
                     			<div class="answerh1">Answers <span class="style2">(${convo.comments.size()})</span></div>
                      			<div class="topicborder"></div>
                      		</div>
                      		#{convoCommentsTree commentsList: convo.comments, level: 1 /}
                      		
                      		
                      			<div class="topic">
                      				<div class="answerCover">
					                    <div class="replyWraper">
					                    	<div class="replyr1">
	                  							<div class="arrowups">
	                  								<a href="#" onclick="toggle_visibility('foo');">&nbsp;</a>
	                  							</div> 
	                  							<div class="arrowdons">
	                  								<a href="#" onclick="toggle_visibility('foo');">&nbsp;</a>
	                  							</div>
	                    					</div><!--replyr1-->
	                   				 		<div class="replyl1">
	                    						<div class="replyz">
								                    <div class="replytop"></div>
								                    <div class="replymid">
								                    	<div class="replypics">
								                    		<img src="/public/images/replypics.jpg" alt="com" />
								                    	</div>
	                    								<div class="replytextarea">
	                      									<p>
	                      										<span class="stylzz"><a href="#">Murry</a> </span> 
	                      										<span class="stylexz"> (Patiant , Advocate) - </span> 
	                      										<span class="stylezx">03 / 01 / 2010</span>
	                      									</p>
	                      									<p>   
	                     								 		<div class="styles1">
	                      											<div class="votestxt3"> 3 votes by  
	                      												<a href="#">Mani</a>,<a href="#">&nbsp;Kan,</a><a href="#">  ...more</a>
	                      											</div>
	                        										<span class="styles2">sdfasdf</span>
	                        									</div>
										                        <div class="sstyles3">
											                        <ul>
												                        <li><a href="#" onclick="toggle_visibility('foo');">1 Reply &nbsp; </a></li>
												                        <li>| </li>
												                        <li><a href="#dialog1" name="modal" > &nbsp;Thank&nbsp;</a></li>
												                      	<li>| </li>
												                        <li><a href="#dialog1" name="modal" >&nbsp;Flag Comment &nbsp;</a></li> 
											                       	</ul>
										                    	</div> 
										                   </p>
														</div><!--replytextarea-->
	                    								<div class="cb"></div>
	                    							</div><!--replymid-->
	                    							<div class="replybot"></div>
	                    							<div class="cb"></div>
	                    						</div><!--replyz-->
	                    						<div class="cb"></div>
                    					
                    				<div id="bobcontent1" class="switchgroup1">
                    <div class="replysub">
                    <div style="clear:both" id="foo">
                    <div class="replysubmidz" >
                    <div class="replypics"><img src="/public/images/mani.jpg" alt="com" /></div>
                    <div class="replytextsub">
                      <p><span class="stylzz"><a href="#">Murry</a> </span> <span class="stylexz"> (Patiant , Advocate) - </span> <span class="stylezx">03 / 01 / 2010
                       </span></p>
                      <p>   
                      <div class="styles1">
                      <div class="votestxt3"> 3 votes by  <a href="#">Mani</a>,<a href="#">&nbsp;Kan,</a><a href="#">  ...more</a></div>
                     
                        <span class="styles2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of typeand scrambled it to make a type </div>
                        <div class="sstyles3">
                        <ul>
                        <li><a href="#">1 Reply  &nbsp; </a></li>
                        <li>| </li>
                        <li><a href="#dialog1" name="modal" > &nbsp;Thank&nbsp;</a></li>
                      <li>| </li>
                        <li><a href="#dialog1" name="modal" >&nbsp;Flag Comment &nbsp;</a></li> 
                       </ul>
                    </a></div> </p></div>
                    <div class="cb"></div>
                    </div><!--replytextsub-->
                    <div style="clear:both">
                    <div class="repcommbox22">
                    <input type="text" class="repcominput" />
                    <div class="repcommstextbox">
                    <input type="submit" class="repcomsubmits" src="/public/images/repcomsubmits.jpg" value=" " />
                     <span class="canclelz"><a href="#">Cancel</a> </span>                    </div>
                    <!--repcommstextbox-->
                    <div class="cb"></div>
                    </div>
                    </div><!--Blankdivsub-->
                    </div><!--Blankdiv-->
                    
                    <div class="cb"></div>
                    </div><!--replysub-->
                    <div class="cb"></div>
                    </div>
                    </div><!--replyl1-->
                    <div class="cb"></div>
                    </div><!--replyWraper-->
                      </div><!--answerCover-->
                      <div class="cb"></div>
                    </div> <!--topic-->
                      <div class="topic">
                       <div class="answerCover" style="padding-top:2px">
                    <div class="replyWraper"  > 
                    <div class="replyr1"><div class="arrowups">   <a href="#">&nbsp;</a> </div> <div class="arrowdons">   <a href="#">&nbsp;</a> </div></div><!--replyr1-->
                    <div class="replyl1">
                    <div class="replyz">
                    <div class="replytop"></div>
                    <div class="replymid">
                    <div class="replypics"><img src="/public/images/maryy.jpg" alt="com" /></div>
                    <div class="replytextarea">
                      <p><span class="stylzz"><a href="#">Murry</a> </span> <span class="stylexz"> (Patiant , Advocate) - </span> <span class="stylezx">03 / 01 / 2010
                         </span>
                      <div class="styles1">
                     <div class="votestxt3"> 3 votes by  <a href="#">Mani</a>,<a href="#">&nbsp;Kan,</a><a href="#">  ...more</a></div>
                        <span class="styles2">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of typeand scrambled it to make a type </div>
                        <div class="sstyles3">
                        <ul>
                        <li><a href="#">1 Reply &nbsp; </a></li>
                        <li>| </li>
                        <li><a href="#dialog1" name="modal" > &nbsp;Thank&nbsp;</a></li>
                      <li>| </li>
                        <li><a href="#dialog1" name="modal" >&nbsp;Flag Comment &nbsp;</a></li> 
                       </ul>
                    </a></div>
                    
                     </p></div>
                    <div class="cb"></div>
                    </div><!--replytextarea-->
                    <!--replymid-->
                    <div class="replybot"></div>
                    <div class="cb"></div>
                    </div><!--replyz-->
                    <div class="cb"></div>
                    <!--replysub-->
                    </div>
                    <!--replyl1-->
                    <div class="cb"></div>
                    </div><!--replyWraper-->
                      </div><!--answerCover-->
                      <div class="cb"></div>
                    </div> <!--topic-->
                      <div class="topipcWraper">
                        <!--topic-->
<div class="topic">
                     
                      <br />
                      <textarea name="textarea" class="answerinput" onclick="this.value=''" >Add New Answer
                      </textarea>
                      <br />
                      <input type="Submit" src="/public/images/addcomments.jpg" class="addcomments" value=" " />

	<div id="middle_area_inner">
		<div id="innerboxarea">
			<div id="innerleft">
				<div id="innerlefttop"></div>
				<div id="innermid">
					<br/><br/>
					Tags: 
					#{list items: convo.topics, as: 'tag'}
						<a href="@{ViewDispatcher.view(tag.mainURL)}">${tag.title}</a>&nbsp;&nbsp;&nbsp;
					#{/list}
					<br/>
					<select id="newTopic">
						#{list items: topicsList, as: 'topicItem'}
							<option value="${topicItem.id}">${topicItem.title}</option>
						#{/list}
					</select>
					<input id="newTopicBtn" type="button" value="Add" />
					<br/><br/>
					
					<br/><br/>
					<div>
						<h3 id="comments">Comments:</h3><br/>

						#{if talker }
							<div id="reply" class="replyForm">
								<ul>
									<li>
										<textarea class="togglecomment" rows="1" cols="45" 
											id="replytext">What are you thinking?</textarea>
								    </li>
									<li id="commentBtn" style="display: none">
										<div style="height: 46px; padding-top: 2px;" class="personaltextarea">
											<a href="#" onclick="return saveProfileComment('');">
												<img width="145" height="32" border="0" src="/public/images/addcomment_btn.gif"/>
											</a>
										</div>
									</li> 
								</ul>
							</div>
						#{/if}
						<div class="commentsarea">
							#{convoCommentsTree commentsList: convo.comments, level: 1 /}
						</div>
					</div>

					<div style="clear: both"></div>

					<br/><br/>
					<br/><br/>
					<h3>Conversation:</h3>
					<br/>
					#{if talker }
						<a href="#" class="restartConvoLink">Re-start conversation</a>&nbsp;
						<a href="#">Start follow up conversation</a>&nbsp;
					#{/if}
					<br/>
					${convo.creationDate?.format('M/d/yyyy')}
					<br/>
					Talkers:
					#{list items: convo.members, as: 'member'}
						<img src="@{Image.show(member)}" width="48" height="48" border="0" />
						${member}&nbsp;&nbsp;&nbsp;
					#{/list}
					<br/><br/>
					#{list items: convo.messages, as: 'message'}
						${message.fromTalker.userName}: ${message.text}<br/>
					#{/list}
				</div>
				<div id="innerbot"></div>
			</div>
			<div id="innerright">
				<!-- 
				<div id="searcharea">
					<input name="" type="text" class="search"  value="Search Conversation" 
						onclick="this.value=''" onblur="this.value='Search Conversation'"/>
				</div>
				<div id="searchright"><img src="/public/images/searchbutton.gif" width="34" height="35" /></div>
				-->
				#{if talker }
				<div class="innerrightbox" style="padding-top: 0px">
					<div class="innerrightop"></div>
					<div class="innerrighmid">
						#{if talker.followingConvosList?.contains(convo.id) }
							<a href="#" id="followConvoLink">Unfollow Conversation</a>
						#{/if}
						#{else}
							<a href="#" id="followConvoLink">Follow Conversation</a>
						#{/else}
					</div>
					<div class="innerrighbot"></div>
				</div>
				#{/if}
				<div class="innerrightbox">
					<div class="innerrightop"></div>
					<div class="innerrighmid">
						<b>Question Statistics</b><br/>
						Latest Activity: ${latestActivityTime?.format('M/d/yyyy')}<br/>
						Views: ${convo.views}<br/>
						Followed by ${convo.followers?.size()} members<br/>
						#{list items: convo.followers, as: 'follower'}
							<a href="@{ViewDispatcher.view(follower.userName)}" title="${follower.userName}" >
								<img src="@{Image.show(follower.userName)}" width="48" height="48" border="0" />
							</a>
						#{/list}
					</div>
					<div class="innerrighbot"></div>
				</div>
			</div>
		</div>
	</div>
</div>