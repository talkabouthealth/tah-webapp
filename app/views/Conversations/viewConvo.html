#{extends 'main.html' /}
	<link rel='stylesheet' type='text/css' href='/public/stylesheets/styles.css' />
	<style>
		body {
			background:url(/public/images/inner_bgmt.gif) repeat-x top;
			font-size: 14px;
		}
		#innermid {
			padding: 10px;
		}
		
		a {color:#333; text-decoration:none}
		a:hover {color:#ccc; text-decoration:none}
		#mask {
		  position:absolute;
		  left:0;
		  top:0;
		  z-index:9000;
		 
		  display:none;
		}
		  
		#boxes .window {
		  position:absolute;
		  left:0;
		  top:0;
		  width:440px;
		  height:200px;
		  display:none;
		  z-index:9999;
		  padding:20px;
		}
		
		#boxes #dialog {
		  width:375px; 
		  height:203px;
		  padding:10px;
		  background-color:#ffffff;
		}
		
		#boxes #dialog1 {
		  width:685px; height:407px;
		}
		
		#dialog1 .d-header {
		  background:url(/public/images/login-header.png) no-repeat 0 0 transparent; 
		  width:375px; 
		  height:150px;
		}
		
		#dialog1 .d-header input {
		  position:relative;
		  top:60px;
		  left:100px;
		  border:3px solid #cccccc;
		  height:22px;
		  width:200px;
		  font-size:15px;
		  padding:5px;
		  margin-top:4px;
		}
		
		#dialog1 .d-blank {
		  float:left;
		  background:url(/public/images/login-blank.png) no-repeat 0 0 transparent; 
		  width:267px; 
		  height:53px;
		}
		
		#dialog1 .d-login {
		  float:left;
		  width:108px; 
		  height:53px;
		}
		
		#boxes #dialog2 {
		  background:url(/public/images/notice.png) no-repeat 0 0 transparent; 
		  width:326px; 
		  height:229px;
		  padding:50px 0 20px 25px;
		}
		.style2 {color: #000000}
		.display {
			background:#FFF;
			width:1px;
			height:1px;
			margin-left:3px;
		}
		
		.deleteTopicLink { margin-right: 10px }
		#topicsList { float: left }
		#topicsList a { margin-right: 10px }
		
		/* Different fixes */
		.answerCover { padding-top: 0px }
		.targetenew a { color:#0D94D6; }
	</style>

	<script type="text/javascript" src="/public/plugins/jquery.inline-edit.js" ></script>
	<script type="text/javascript">
		var tid = '${convo.tid}';
		$(document).ready(function() {
			$("#followConvoLink").click(function() {
				$.post("@{Conversations.follow()}", 
	  				{ topicId: '${convo.id}'},
	  				function(data) {
	  					if ($("#followConvoLink").html() == "Follow Conversation") {
	  						$("#followConvoLink").html("Unfollow Conversation");
	  					}
	  					else {
	  						$("#followConvoLink").html("Follow Conversation");
	  					}
	  				}
	  			);
			});

			$(".restartConvoLink").click(function() {
				openChat(tid);
				$.post("@{Conversations.restart}", {topicId: '${convo.id}'});
			});

			$(".flagConvoLink").click(function() {
				var reason = prompt("Reason:");
				if (reason) {
					$(this).after("<span>Thanks!</span>").detach();
					
					$.post("@{Conversations.flag}", 
							{reason: reason, topicId: '${convo.id}'}
					);
				}
			});

			//----- Comments ------
			$(".votebtn").live("click", function() {
	   				var value = $(this).attr("title") === "up" ? true : false;
	   				var answerId = $(this).attr("rel");

	   				$.post("@{Conversations.vote}", 
	   		   				{ answerId : answerId, up : value },
	   		   				function(data) {
		   		   				if (data !== "ok") {
			   		   				alert(data);
		   		   				}
	   		   				}
		   				);

	   				return false;
	   			});
	   		

   			//------- Edits ----------
   			$("#titleBtn").click(function() {
   	   			var newValue = $("#titleinput").val();
   	   			$("#convoTitle").html(newValue);
   	   			//hide edit
   	   			shoit('1');
   	   			$("#hidit1 .display").show();
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'title', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	

   			$("#addDetailsLink").click(function() {
   	   			$("#hiditEmptyDiv2").hide();
   	   			$("#editit2").show();
   	   			return false;
   			});

   			$("#detailsBtn").click(function() {
   	   			var newValue = $("#detailsinput").val();
   	   			if (newValue === '') {
   	   				$("#hiditEmptyDiv2").show();
   	   				$("#hiditDiv2").hide();
   	   			}
   	   			else {
   	   				$("#hiditDiv2").show();
   	   				$("#convoDetails").html(newValue);
   	   				$("#hidit2 .display").show();
   	   			}
	   			//hide edit
	   			shoit('2');
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'details', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	

   			$("#addSummaryLink").click(function() {
   	   			$("#hiditEmptyDiv13").hide();
   	   			$("#editit13").show();
   	   			return false;
   			});

   			$("#summaryBtn").click(function() {
   	   			var newValue = $("#summaryinput").val();
   	   			if (newValue === '') {
	   				$("#hiditEmptyDiv13").show();
	   				$("#hiditDiv13").hide();
	   			}
	   			else {
	   				$("#hiditDiv13").show();
	   				$("#convoSummary").html(newValue);
	   				$("#hidit13 .display").show();
	   			}
	   			//hide edit
	   			shoit('13');
	   			$("#hidit13 .display").show();
   	   			$.post("@{Conversations.updateField()}", 
   	   					{ convoId : '${convo.id}', name: 'summary', value: newValue},
   	   					function() {
   	   	   					//good save!!
   	   					}
   	   				);
   			});	


   			//Topics
   			$("#addTopicBtn").click(function() {
   	   			//topicInput
   	   			var newTopic = $("#topicInput").val();
   	   			$("#topicInput").val("");

   	   			shoit('4');
   	   			$("#display4").show();

   	   			$.post("@{Conversations.updateField()}", 
   					{ convoId : '${convo.id}', name: 'topic', value: newTopic, todo: 'add'},
   					function(html) {
   	   					$(html).appendTo($("#topicsLinks"));

   	   					//update static topics
   	    	   			$("#topicsList").html("");
   	    	   			$("#topicsLinks a[class='topicTitle']").each(function(i, item) {
   	    	   	   			$("#topicsList").append($(item).clone());
   	    	   			});
   					}
   				);
   			});

   			$("#editit4 .cancel").click(function() {
   				//update static topics
   	   			$("#topicsList").html("");
   	   			$("#topicsLinks a[class='topicTitle']").each(function(i, item) {
   	   	   			$("#topicsList").append($(item).clone());
   	   			});
   			});
   			
   			$(".deleteTopicLink").live("click", function() {
   	   			$(this).prev().remove();
   	   			var topicId = $(this).attr("rel");
   	   			$(this).remove();

   	   			$.post("@{Conversations.updateField()}", 
	   					{ convoId : '${convo.id}', name: 'topic', value: topicId, todo: 'remove'},
	   					function() {
	   	   					//good save!!
	   					}
	   				);
   			});

   			$('.inline-edit').inlineEdit({hover: 'hover'})
		});

   		//public static void saveTopicComment(String topicId, String parentId, String text) {
   		function saveProfileComment(parentId) {
   	   		var commentText = $("#replytext"+parentId).val();
   			$("#replytext"+parentId).val("");

   			$.post("@{Conversations.saveTopicComment()}", 
  				{ topicId: '${convo.id}', parentId: parentId, text: commentText},
  				function(html) {
  	  				$("#firstcommentmessage").hide();
  					$("#replyform"+parentId).before($(html));
  				}
  			);

  			return false;
   		}

   		//public static void updateAnswer(String answerId, String newText) {
   		function updateAnswer(answerId) {
   	   		var newValue = $("#answerInput"+answerId).val();

   	   		$("#answerText"+answerId).html(newValue);
   	   		$("#hidit"+answerId+" .display").show();
   	   		shoit(answerId);

   	   		$.post("@{Conversations.updateAnswer()}", 
  				{ answerId: answerId, todo: 'update', newText: newValue},
  				function(html) {
  	  				//...
  				}
  			);
   		}

   		function deleteAnswer(answerId) {
   	   		var confirmDel = confirm("Are you sure want to delete this answer?");
   	   		if (confirmDel) {
   	   	   		$("#comment"+answerId).remove();

   	   	  	$.post("@{Conversations.updateAnswer()}", 
    				{ answerId: answerId, todo: 'delete', newText: ''},
    				function(html) {
    	  				//...
    				}
    			);
   	   		}
   	   		return false;
   		}

   		function deleteConvo() {
   	   		var confirmDel = confirm("Are you sure want to delete this conversation?");
   	   		if (confirmDel) {
   	   	  		$.post("@{Conversations.delete()}", 
    				{ convoId : '${convo.id}'}
    			);

   	   	  		document.location = "/home";
   	   		}
   	   		
   	   		return false;
   		}
   		

   		//show and hide for field edits
	    function hidit(id) {
		    $("#hidit"+id).hide();
			return false;
	    }
		function shoit(id) {
			$("#editit"+id).hide();
			$("#hidit"+id).show();
			return false;
		}
	</script>
</head>

<body>
<div id="top_container">
	<div id="top">
		#{ logo /}
		<div id="topnav">
			#{include 'menu.html' /}
		</div>
	</div>
</div>

<div id="innerbanner"></div>
<div id="bottom_container">

	<div id="targetedtherapy">
		<div id="innermiddlearea">
			<div id="mtcover">
				<div id="mtleft">
					<div class="mtcontent">
						<div id="targetedtherapy">
							<div class="suggescover">
								<div class="editsWraper">
									<div class="editsWraper">
										<div class='inline-edit'>
											<div id="hidit1">
												<div id="convoTitle" class="targetedh7" style="display:block;">${convo.topic}</div>
												<div class="display" style="display:block;">
													<div class="editit" style="display:block;">
														<a href="#" onclick="hidit('1')">Edit</a>
													</div>
												</div>
										    </div>
										    <div style="margin-top:10px; margin-bottom:10px;"></div>
											<div class='form' id="editit1">
												<div style="float:left; width:auto; padding-bottom:5px;" >
										        	<input id="titleinput" type="text"
										        		value="${convo.topic}" class="edititinputs" style="width:600px"  >
										        </div>
												<div style="float:right;margin-right:30px;">
											        <input id="titleBtn" type="submit"  class="updatebtns" value=" " />
											        <div class="canclebtnz">
											        	<a class="cancel" href="#" onclick="shoit('1')">Cancel</a>
											        </div>
												</div>
											</div>
										</div>
									</div>
								</div><!--editsWraper-->
								<div style="clear:both">
									<div class='inline-edit'>
										<div class="suggestxt" id="hidit2">
											<div id="hiditDiv2" style="display: ${convo.details ? 'block' : 'none'}">
												<p id="convoDetails" style="float:left; padding-top:10px;">${convo.details}</p>
												<div class='display'>
													<div class="editit" style="padding-top:10px;">
														<a href="#" onclick="hidit('2')">Edit</a>
													</div>
												</div>
											</div>
											<div id="hiditEmptyDiv2" style="display: ${!convo.details ? 'block' : 'none'}">
												<div class="targetenew">
													<a id="addDetailsLink" href="#">Add Conversation Details</a>
												</div>
											</div>
                    					</div>
										<div class='form' id="editit2">
											<div style="padding-top:10px;">
										        <textarea id="detailsinput" class="edititinputx" 
										        	style="width:600px">${convo.details}</textarea>
									        </div>
											<div style="float:right;margin-right:30px;">
												<input id="detailsBtn" type="submit" class="updatebtns" value=" " />
												<div class="canclebtnz">
													<a class="cancel" href="#" onclick="shoit('2')">Cancel</a>
												</div>
											</div>
										</div>
									</div>
								</div> <!--Blank-->   
							</div><!--suggescover-->
                  		</div> <!--targetedtherapy-->
                  		<div class="topipcWraper">
                    		<div class="topic">
                      			<div class='inline-edit'>
									<div class="topictxt" id="hidit4" style="display:block; float:left; width:auto;">
										<div style="float:left;">Topics: &nbsp;&nbsp;&nbsp;&nbsp;</div>
										<div id="topicsList">
											#{list items: convo.topics, as: 'tag'}
												<a href="@{ViewDispatcher.view(tag.mainURL)}">${tag.title}</a>
											#{/list}
										</div>
										
										<!-- 
											<div class="suuport"><a href="#"></a></div>
											<div class="Helptag"><a href="#"></a></div> 
										 -->
									</div>
									<div id="display4" class='display' style="padding-top:10px;">
										<div class="editit">
											<a href="#"  onclick="hidit('4')">Edit</a>
										</div>
									</div>       
									<div class='form' style="clear:both; padding-top:5px;" id="editit4">
									     <div id="topicsLinks" class="topictxt" style="display:block; float:left; width:auto;">
											<div style="float:left;">Topics &nbsp;&nbsp;&nbsp;&nbsp;</div>
											#{list items: convo.topics, as: 'tag'}
												<a class="topicTitle" href="@{ViewDispatcher.view(tag.mainURL)}">${tag.title}</a>
												<a class="deleteTopicLink" href="#" rel="${tag.id}">X</a>
											#{/list}
											<!-- 
											<div class="suuportzz"><a href="#"></a></div>
									 		<div class="Helptagzz"><a href="#"></a></div> 
									 		-->
										</div>
										<div class="addcomCover" style="width:400px;">
											<input type="text" id="topicInput" 
												class="addcominput"  value="" style="float:left; width:215px;"/>
						                   	<input type="submit" value=" " id="addTopicBtn" 
						                   		class="addcomsubmit" style="float:left; width:80;"  />
									        <div class="canclebtnz" style="float:left; width:auto;">
									          	<a class="cancel" href="#" onclick="shoit('4')">Cancel</a>
									        </div> 
									    </div>
									</div><!--form--> 
								</div>
                      
                      			#{if talker }
									<div class="tagtxts">
				                    	<a href="#" class="restartConvoLink">Restart Conversation </a> |  
				                    	<a href="#">Start Follow up conversation</a>  |  
				                    	<a href="#" class="flagConvoLink">Flag Question </a> 
				                    	#{if session.username?.equals("admin") }
				                        	  |  <a href="#" onclick="return deleteConvo();">Delete</a> 
				                        #{/if}
				                    </div>
								#{/if}
								<div class="cb"></div>
							</div> <!--topic-->
							
                    		<div class="topic">
                    			<div class="cscover">
                    				<div class="cstop">
					                   <div class='inline-edit'>
					 						<div class="cstoptext" id="hidit3">Conversation Summary</div>
										</div>
                    				</div><!--cstop-->
				                    <div class="csmid">
				                    	<div class="cmmidtext">
                     						<div class='inline-edit' style="width: 100%">
                     							<div id="hidit13">
                     								<div id="hiditDiv13" style="display: ${convo.summary ? 'block' : 'none'}">
														<div id="convoSummary" style="display:block;padding-right:30px;text-align:justify">
															${convo.summary ? convo.summary : "Add summary..."}
														</div> 
														<div class='display' style="float:right;margin-right:80px;">
															<div class="editit" style="margin-top:7px;">
																<a href="" onclick="hidit('13')">Edit</a>
															</div>
														</div>
													</div>
                     								<div id="hiditEmptyDiv13" style="display: ${!convo.summary ? 'block' : 'none'}">
														<div class="targetenew">
															<a id="addSummaryLink" href="#">Add Conversation Summary</a>
														</div>
													</div>
												</div>
												<div style="margin-top:10px; margin-bottom:10px; clear: both"></div>
												<div class='form' id="editit13">
													<div style="float:left; width:auto;">
        												<textarea style="width:585px;height:230px;font-size:13px;font-weight:normal" 
        													id="summaryinput" class="edititinputs">${convo.summary}</textarea>
        											</div>
													<div style="float:right; width:auto;margin-right:30px;">
														<input id="summaryBtn" class="updatebtns" value=" " />
														<div class="canclebtnz">
															<a class="cancel" href="javascript:void()" onclick="shoit('13')">Cancel</a>
														</div>
													</div>
												</div>
    										</div>
    										#{if convo.sumContributors }
	    										<div style="clear: both; padding-top: 10px;">
	    											<span class="blacktext">Contributions By:</span> 
													<span class="blacktext">
														#{list items: convo.sumContributors, as: 'contributor'}
															#{ifnot contributor_isLast}
																<a href="#">${contributor.userName}</a>, 
															#{/ifnot}
															#{else}
																<a href="#">${contributor.userName}</a>
															#{/else}
														#{/list}
													</span>
	    										</div>
    										#{/if}
    										#{else}
    											<div style="clear: both; padding-top: 10px;">&nbsp;</div>
    										#{/else}
										</div><!--cmmidtext-->
                    				</div><!--csmid-->
                    				<div class="csbot"></div>
                    			</div>
                    		</div><!--topic-->
                    		
                     		<div class="topic" style="margin-bottom: 15px;">
                     			<div class="answerh1">Answers <span class="style2">(${convo.comments.size()})</span></div>
                      			<div class="topicborder"></div>
                      		</div>
                      		
                      		#{convoCommentsTree commentsList: convo.comments, level: 1 /}
                        
							<div class="topic" id="replyform"><br />
								<textarea name="textarea" id="replytext" class="answerinput" 
									onclick="this.value=''">Add New Answer</textarea><br />
								<input type="submit" onclick="return saveProfileComment('');" 
									src="/public/images/addcomments.jpg" class="addcomments" value=" " />
								<div class="answerh2 style1 style2">Conversation</div>
								<div class="topicborder"></div>
								
								<div class="tagtxts"><a href="#">Restart Conversation </a> |  
									<a href="#">Start Follow up conversation</a>  |  <a href="#">Flag Question </a> </div>
								
								<div class="talkerCover">
									<div class="talkertop">Talkers</div>
									<div class="talkermid"><br />
										#{list items: convo.members, as: 'member'}
											<img src="@{Image.show(member)}" width="48" height="48" border="0" />
											${member}&nbsp;&nbsp;&nbsp;
										#{/list}
										<!--
							              <div class="talkertxt">
							              <div class="talktextleft"><span class="uzername"><a href="#">tom:</a></span></div>
							              <div class="talktextright"><span class="uzername"><a href="#">Janifer</a></div>
							              </div>talkertxt-->
							              
										#{list items: convo.messages, as: 'message'}
											<div class="talkertxt1">
												<span class="uzername"><a href="#">${message.fromTalker.userName}:</a></span>
												&nbsp;&nbsp;${message.text} 
											</div>
										#{/list}
									</div><!--talkermid-->
									<div class="talkerbot"></div>
								</div><!--talkerCover-->
							    <div class="cb"></div>
							</div>
							<div class="cb"></div>
						</div>
						<div class="cb"></div>
					</div><!--mtcontent-->
                </div>
				<div id="mtright1" style="padding-top: 10px">
					#{if talker }
						#{if talker.followingConvosList?.contains(convo.id) }
							<a href="#" id="followConvoLink">Unfollow Conversation</a>
						#{/if}
						#{else}
							<a href="#" id="followConvoLink">Follow Conversation</a>
						#{/else}
					#{/if}
				    <!-- <input type="submit" class="followcn"  src="../TalkAboutHealth//public/images/followcn.jpg" value=" "  /> -->
				    <div class="cb"></div>
					<div class="topipsts">
						<div class="Statics">
							<div class="Staticsh1">Question Statistics</div>
							<p style="color:#000000">
								<strong>Latest Activity:</strong> ${latestActivityTime?.format('MM / dd / yyyy')} <br />
								<strong>Views:</strong> ${convo.views}<br />
								<strong>Followed By:</strong> ${convo.followers?.size()} members<br/>
								#{list items: convo.followers, as: 'follower'}
									<a href="@{ViewDispatcher.view(follower.userName)}" title="${follower.userName}" >
										<img src="@{Image.show(follower.userName)}" width="48" height="48" border="0" />
									</a>
								#{/list}
							</p><br />
							<!-- <div class="topicborder"></div>  -->
						</div>
						<div class="cb"></div>
					</div><!--topipsts-->
					*{
				                <div class="topipsts">
				               <div class="rconversation">
				              <div class="Staticsh1 style1 style2">Related Conversations</div>
				              <p class="rcpadtop"><a href="#">Printer text of the printing and typesettin
				                industry. Lorem Ipsum has Done</a> </p>
				              <p class="rcpadtop">
				                <a href="#">Since the text of the printing and typeset
				                industry. Lorem Ipsum has Done </a></p>
				              <p class="rcpadtop">
				                <a href="#">ummy text of the printing and typesettin
				                industry. Lorem Ipsum has Done </a></p>
				              <p><br />
				                      <a href="#"><strong>See More Related Conversation</strong></a> </p>
				               </div>
				                <div class="cb"></div>
				                </div><!--topipsts-->
				    }*
                	<div class="cb"></div>
				</div>
            	<div class="cb"></div>
            </div><!--mtcover-->
            <div class="cb"></div>
		</div>
	</div>
</div>

*{

	<div id="middle_area_inner">
		<div id="innerboxarea">
			<div id="innerleft">
				<div id="innerlefttop"></div>
				<div id="innermid">
					<br/><br/>
					Tags: 
					#{list items: convo.topics, as: 'tag'}
						<a href="@{ViewDispatcher.view(tag.mainURL)}">${tag.title}</a>&nbsp;&nbsp;&nbsp;
					#{/list}
					<br/>
					<input id="newTopicBtn" type="button" value="Add" />
					<br/><br/>
					
					<br/><br/>
					<div>
						<h3 id="comments">Comments:</h3><br/>

						#{if talker }
							<div id="reply" class="replyForm">
								<ul>
									<li>
										<textarea class="togglecomment" rows="1" cols="45" 
											id="replytext">What are you thinking?</textarea>
								    </li>
									<li id="commentBtn" style="display: none">
										<div style="height: 46px; padding-top: 2px;" class="personaltextarea">
											<a href="#" onclick="return saveProfileComment('');">
												<img width="145" height="32" border="0" src="/public/images/addcomment_btn.gif"/>
											</a>
										</div>
									</li> 
								</ul>
							</div>
						#{/if}
						<div class="commentsarea">
							#{convoCommentsTree commentsList: convo.comments, level: 1 /}
						</div>
					</div>

					<div style="clear: both"></div>

					<br/><br/>
					<br/><br/>
					<h3>Conversation:</h3>
					<br/>
					#{if talker }
						<a href="#" class="restartConvoLink">Re-start conversation</a>&nbsp;
						<a href="#">Start follow up conversation</a>&nbsp;
					#{/if}
					<br/>
					${convo.creationDate?.format('M/d/yyyy')}
					<br/>
					Talkers:
					
					<br/><br/>
					
				</div>
				<div id="innerbot"></div>
			</div>
		</div>
	</div>
}*
