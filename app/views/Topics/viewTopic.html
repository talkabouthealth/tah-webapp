#{extends 'main.html' /}
	<style>
		body {
			background:url(/public/images/inner_bg.gif) repeat-x top;
			font-size: 14px;
		}
		#innermid {
			padding: 10px;
		}
		
		#reply {
			padding: 10px 0 0 0;
		}
		.commentsarea {
			padding-top: 0px;
		}
		#replytext {
			height: 20px;
			color: #777777;
		}
		.commentreply {
			height: 20px;
			color: #777777;
		}
	</style>

	<script type="text/javascript">
		$(document).ready(function() {
			$("#followTopicLink").click(function() {
				$.post("@{Topics.follow()}", 
	  				{ topicId: '${topic.id}'},
	  				function(data) {
	  					if ($("#followTopicLink").html() == "Follow Topic") {
	  						$("#followTopicLink").html("Unfollow Topic");
	  					}
	  					else {
	  						$("#followTopicLink").html("Follow Topic");
	  					}
	  				}
	  			);
			});

			$(".followTopicLink").live('click', function() {
				var topicId = $(this).attr("rel");
				if ($(this).html().indexOf("Unfollow") != -1) {
					$(this).html("Follow");
				}
				else {
					$(this).html("Unfollow");
				}
				$.post("@{Conversations.follow()}", 
	  				{ topicId: topicId},
	  				function(data) {
	  					//...
	  				}
	  			);
	  			return false;
			});
		});

		function restartConvo(tid, convoId) {
			openChat(tid);
			$.post("@{Conversations.restart}", {topicId: convoId});
			return false;
		}

		function openChat(tid){
			window.open("@{Talk.talkApp()}/"+tid, "TalkerWindow", "width=700,height=500");
		}
	</script>
</head>

<body>
<div id="top_container">
	<div id="top">
		#{ logo /}
		<div id="topnav">
			#{include 'menu.html' /}
		</div>
	</div>
</div>

<div id="innerbanner"></div>
<div id="bottom_container">
	<div class="blacktext2" id="innerheading">${topic.title}</div>
	<div id="middle_area_inner">
		<div id="innerboxarea">
			<div id="innerleft">
				<div id="innerlefttop"></div>
				<div id="innermid">
					<h3>Topic Summary:</h3><br/>
					${topic.summary}<br/>
					Contributions by: 
					#{list items: topic.sumContributors, as: 'contributor'}
						${contributor}&nbsp;&nbsp;&nbsp;
					#{/list}
					<br/><br/><br/><br/>
					
					<div style="clear: both"></div>
					<h3>Conversations/Questions:</h3><br/>
					#{list items: topic.conversations, as: 'convo' }
						<a href="@{ViewDispatcher.view(convo.mainURL)}"><b>${convo.topic}</b></a><br/>
						Started by: 
						<a href="@{ViewDispatcher.view(convo.talker.userName)}" 
							class="blue13"><strong>${convo.talker.userName}</strong></a>
						<span class="blacktext12">
							#{if convo.talker.connection}
								(${convo.talker.connection}, ${convo.talker.levelOfRecognition})
							#{/if}
							#{else}
								(${convo.talker.levelOfRecognition})
							#{/else}
						</span><br/>
						
						#{if talker }
							${convo.comments.size()} Answer(s)&nbsp;|&nbsp;
							${convo.members.size()} member(s) spoke&nbsp;|&nbsp;
							<a href="#" class="bluetext12 followTopicLink" rel="${convo.id}">
							${ talker.followingConvosList?.contains(convo.id) ? 'Unfollow' : 'Follow'}
							</a>&nbsp;|&nbsp;
							<a href="#" onclick="return restartConvo(${convo.tid}, '${convo.id}');" 
								class="restartConvoLink">Re-start</a>&nbsp;|&nbsp;
							${convo.creationDate?.since()}
						#{/if}
						#{if convo.comments.size() > 0}
							<div style="padding-left: 10px">
								#{set answer = convo.comments.get(0) /}
								Top Answer by: ${answer.fromTalker.userName}<br/>
								${answer.text}
							</div>
						#{/if}
					#{/list}				
					<br/><br/>
					<br/><br/>

					<h3>Latest activities:</h3><br/>
					#{list items: activities, as: 'activity'}
						<span class="blacktext12">${activity.toHTML().raw()}</span><br/>
						<span class="greytext11">${activity.time.format("MMM dd 'at' HH:mm a")}</span><br />
					#{/list}
					
					<br/><br/>
					<br/><br/>
					<br/>
					${topic.creationDate?.format('M/d/yyyy')}
					<br/>
				</div>
				<div id="innerbot"></div>
			</div>
			<div id="innerright">
				<!-- 
				<div id="searcharea">
					<input name="" type="text" class="search"  value="Search Conversation" 
						onclick="this.value=''" onblur="this.value='Search Conversation'"/>
				</div>
				<div id="searchright"><img src="/public/images/searchbutton.gif" width="34" height="35" /></div>
				-->
				#{if talker }
				<div class="innerrightbox" style="padding-top: 0px">
					<div class="innerrightop"></div>
					<div class="innerrighmid">
						#{if talker.followingTopicsList?.contains(topic) }
							<a href="#" id="followTopicLink">Unfollow Topic</a>
						#{/if}
						#{else}
							<a href="#" id="followTopicLink">Follow Topic</a>
						#{/else}
					</div>
					<div class="innerrighbot"></div>
				</div>
				#{/if}
				<div class="innerrightbox">
					<div class="innerrightop"></div>
					<div class="innerrighmid">
						<a href="@{Home.index()}">Home</a><br/>
						<a href="#">Your Feeds</a><br/>
						<a href="#">Your Comment</a><br/>
						<a href="#">Open Questions</a><br/><br/><br/>
						
						<a href="#">Manage Topic</a>
					</div>
					<div class="innerrighbot"></div>
				</div>
				<div class="innerrightbox">
					<div class="innerrightop"></div>
					<div class="innerrighmid">
						<b>Topic Statistics</b><br/>
						Conversations/Questions: ${topic.conversations?.size()}<br/>
						Views: ${topic.views}<br/>
						Followed by ${topic.followers?.size()} members<br/>
						#{list items: topic.followers, as: 'follower'}
							<a href="@{ViewDispatcher.view(follower.userName)}" title="${follower.userName}" >
								<img src="@{Image.show(follower.userName)}" width="48" height="48" border="0" />
							</a>
						#{/list}
					</div>
					<div class="innerrighbot"></div>
				</div>
			</div>
		</div>
	</div>
</div>