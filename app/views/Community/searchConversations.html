#{ extends 'main.html' /}

<link rel="stylesheet" href="/public/plugins/ui-lightness/jquery-ui-1.8.4.custom.css" type="text/css" media="screen" />
<script type="text/javascript" 
	src="/public/javascripts/jquery-ui-1.8.4.custom.min.js" ></script>
	
<script type="text/javascript">
$(function() {
	var cache = {};
	$( "#query" ).autocomplete({
		minLength: 1,
		source: function(request, response) {
			if ( request.term in cache ) {
				response( cache[ request.term ] );
				return;
			}
			
			$.ajax({
				url: "@{Search.ajaxConvoSearch()}",
				dataType: "json",
				data: request,
				success: function( data ) {
					cache[ request.term ] = data;
					response( data );
				}
			});
		},
		select: function(event, ui) {
			var url = ui.item.url;
			document.location = url;
			return false;
		}
	})
	.data( "autocomplete" )._renderItem = function( ul, item ) {
		return $( "<li></li>" )
			.data( "item.autocomplete", item )
			.append( "<a>" + item.label + "&nbsp;<span>" + item.type + "</span></a>" )
			.appendTo( ul );
	};


});
</script>

	<script type="text/javascript"> 	 
		$(document).ready(function() {
			
		});
   	</script>
	<style>
		body {
			background:url(/public/images/inner_bg.gif) repeat-x top;
			font-family:arial;
			font-size:11px;
		}
	</style>
</head>
<body>
	<div id="top_container">
		<div id="top">
			#{ logo /}
			<div id="topnav">
				#{ include 'menu.html' /}
			</div>
		</div>
	</div>
	<div id="innerbanner"></div>
	<div id="innermain">
		<div class="blacktext2" id="innerheading">Search Conversations</div>
		<div id="innermiddlearea">
           	<form name="searchForm" action="@{Community.searchConversations()}" method="POST">
				<div id="searcharea">
					<input id="query" name="query" type="text" class="search"  value="${flash.query ? flash.query : 'Search Conversations'}" 
						onclick="if (this.value == 'Search Conversations') this.value=''" onblur=""/>
				</div>
				<div id="searchright">
					<a href="#" onclick="document.searchForm.submit(); return false;">
						<img src="/public/images/searchbutton.gif" width="34" height="35" border="0"/>
					</a>
				</div>
			</form>
			
			#{if results }
				<div class="activitiestext" style="font-size: 14px; clear: left">		
					#{list items:results, as: 'convo'}
						<div class="area">
							<div class="arealeft2">
								<a href="@{ViewDispatcher.view(convo.talker.userName)}" class="bluetext11">
									<img src="@{Image.show(convo.talker.userName)}" width="71" height="71" border="0" />
									<br /><span class="bluetext11">${convo.talker.userName}</span>
								</a>
					  			<br/>
					  			<span class="blacktext11">${convo.talker.levelOfRecognition}</span>
					  		</div>
							<div class="arearight">
							    <div class="areatop"></div>
							    <div class="areamid">
							    	<div class="areamidleft">
							    		<p>
							    			<span class="blacktext14">
							    				<a href="@{ViewDispatcher.view(convo.mainURL)}">${convo.topic}</a><br />
							    				<span class="blacktext12">${convo.comments.size()} answer(s)</span> | 
					        					<span class="blacktext12">${convo.members.size()} people spoke</span> | 
					        					<a href="@{ViewDispatcher.view(convo.mainURL)}#comments" class="bluetext12">Comment</a> | 
					        					<a href="#" class="bluetext12 followTopicLink" rel="${convo.id}">
												${ talker.followingConvosList?.contains(convo.id) ? 'Unfollow' : 'Follow'}
												</a> | 
												<a href="#" class="bluetext12 restartTopicLink" 
													rel="${convo.id}" rel2="${convo.tid}">Re-start</a> | 
					        					*{ TODO: joined/started/etc }*
					        					<span class="blacktext12">${convo.creationDate.since()}</span>
					        				</span>
					        			</p>
					        			#{if convo.comments.size() > 0 }
					        				<p>
					        					#{set topAnswer = convo.comments.get(0) /}
						        				<span class="blacktext14">Top Answer by: ${topAnswer.fromTalker.userName}</span><br/>
						        				<span class="blacktext12">${topAnswer.text}</span>
						        			</p>
					        			#{/if}
					        		</div>
								</div>
				  				<div class="areabot"></div>
				 	 		</div>
						</div>		
					#{/list}
					#{else}
						No results.
					#{/else}
				</div>
			#{/if}
		</div>
	</div>