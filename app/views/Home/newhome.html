#{extends 'main.html' /}
	<style type="text/css">
		body { background:transparent url(/public/images/inner_bgmt.gif) repeat-x scroll center top; }
		
		#innermiddlearea { padding-top: 10px }
		.seeall { padding-top: 20px }
		
		.inline_form { display:none; }
	</style>
	
	<script type="text/javascript" src="/public/plugins/jquery.truncatable.js" ></script>
	<script type="text/javascript" src="/public/plugins/jquery.inline-edit.js" ></script>
	<script type="text/javascript">
		var username = "${talker.userName}";

		var titleLimit = 150;
		var feedsPerPage = ${logic.FeedsLogic.FEEDS_PER_PAGE};

		#{ oauthJavaScripts /}

		$(document).ready(function() {
			makeAutocomplete("#convoText", "convo");
			
			$(".followConvoLink").live('click', function() {
				var convoId = $(this).attr("rel");
				if ($(this).html().indexOf("Unfollow") != -1) {
					$(this).html("Follow");
				}
				else {
					$(this).html("Unfollow");
				}
				$.post("@{Conversations.follow()}", 
	  				{ convoId: convoId},
	  				function(data) {
	  					//...
	  				}
	  			);
	  			return false;
			});

			var showIMPopup = ${showIMPopup};
			//showIMPopup = true;
			if (showIMPopup) {
				var id = "#imDialog";
				showPopup(id, 350);
			}

			$('.window #saveIMBtn').click(function (e) {
				//Cancel the link behavior
				e.preventDefault();

				var imService = $("#imDialog input[checked=true]").val();
				var imUserName = $("#imUserName").val();

				if (imService.length == 0) {
					alert("Please choose IM Service");
					return;
				}

				if (imService === "Twitter") {
					$('#mask').hide();
					$('.window').hide();
					
					openTwitter();
				}
				else {
					if (imUserName.length == 0) {
						alert("Please enter correct IM Username");
						return;
					}
					
					$.post("@{Profile.addIMAccount()}", 
						{imUserName : imUserName, imService : imService},
						function(data) {
							if (data.indexOf("<tr>") == 0) {
								$("#imUserName").val("");

								$('#mask').hide();
								$('.window').hide();
							}
							else {
								alert(data);
							}
						}
					);
				}
			});	

			$(".startLink").click(function(e) {
				$("#newConvoTypeQuestion").attr("checked", "checked");
				
				$("#newConvoForm").show();
				$("#newQuestionConfirm").hide();
				$("#newTalkConfirm").hide();
				$("#newConvoTitle").val($("#convoText").val());
				showPopup("#startDialog", 350);
			});

			//TODO: move everything to one .js function
			$(".startLink2").click(function(e) {
				$("#newConvoTypeConvo").attr("checked", "checked");
				
				$("#newConvoForm").show();
				$("#newQuestionConfirm").hide();
				$("#newTalkConfirm").hide();
				$("#newConvoTitle").val($("#convoText").val());
				showPopup("#startDialog", 350);
			});

			$('.inline-edit').inlineEdit( { hover: ''} );
			$('.moretext').truncatable({ limit: 160, more: '... more', less: true, hideText: '' });
		});

		//for comments/replies in feed
		function showReplyForm(commentId) {
			$("#reply"+commentId+" .inline_display").hide();
			$("#reply"+commentId+" .inline_form").show();
			$("#reply"+commentId).show();
			return false;
		}

		//saveProfileComment(String profileTalkerId, String parentId, String text)
   		function saveProfileComment(parentId) {
   	   		var commentText = $("#replytext"+parentId).val();
   			$("#replytext"+parentId).val("");

   			$.post("@{Actions.saveProfileComment2()}", 
  				{ parentId: parentId, text: commentText},
  				function(html) {
  	  				$("#firstcommentmessage").hide();
  					//put comment in the tree
  					if (parentId == '') {
  	  					//add as first element in the top
  						$(html).prependTo($(".commentsarea"));

  	  					//add inline edit for new comment
  						$('.inline-edit').inlineEdit( { hover: ''} );
  					}
  					else {
  						//add as last element in subtree
  						$("#reply"+parentId).before($(html));
  					}
  				}
  			);

   			
  			return false;
   		}
	</script>
		
<div id="managtopic1" style="background:url(/public/images/inner_bgmt.gif); background-repeat:repeat-x;">
  <div id="managtopic">
  	#{include 'header.html' /}
  	<div id="bottom_container">
      	<div class="haderbanner"><div id="innerbanner"></div></div>
        <div id="innermiddlearea">
          <div id="mtcover">
            <div id="mtleft">
              <div class="mtcontent">
                <div id="targetedtherapy">
                  <div class="comh1">Ask a question or start a talk</div>
                  <div class="comborder"></div>
                </div>
                <div class="topipcWraper">
                  #{startConvoInput /}

                  <!--startsearchbox-->
                  <div class="topic">
                    <div class="newpage1">
                    	<a href="@{Explore.liveTalks()}">Live Breast Cancer Community Talks (${liveConversations.size()})</a></div>
                    <!-- <a href="#"><img src="/public/images/refreshicon.jpg" alt="refresh" 
                    	border="0" style="float:left; padding-left:4px; padding-top:22px"  /></a> -->
                    #{if liveConversations?.size() > 5}
                    	<div class="seeall"><a href="#">See All</a></div>
                    #{/if}
                    <div class="topicborder"></div>
                    <!--mtinputbox-->
                    <div class="cb"></div>

                    <div class="newpageCover">
                   		#{list items: liveConversations, as: 'convo'}
							#{liveTalk convo: convo, talker: talker /}		                      
						#{/list}
						#{else}
							<a href="#" class="startLink2" style="font-size: 16px;">Be the first to start a live talk.</a>
						#{/else}
                      <!--joinbox-->
                      
                      <div class="topic">
                        <div class="newpage1"><a href="@{Home.conversationFeed()}">Your Conversation Feed</a></div>
                        <div class="topicborder"></div>
                        <div class="cb"></div>
                      </div>
                      <div class="topic">
                        <div id="convoFeedList" class="conversationsList">
	                    	#{list items: convoFeed, as: 'activity'}
								#{feedActivity activity: activity, talker: talker /}
							#{/list}
							#{else}
								<span class="blacktext16">When you Follow Topics, Conversations, and
									other members, your Conversation Feed will be filled with their updates.</span>
							#{/else}
						</div>
						#{if convoFeed.size() == logic.FeedsLogic.FEEDS_PER_PAGE }
							<div class="replytommentbox" id="convoFeedBtn">
	                          <input type="submit" src="images/seemore.jpg" 
	                          	onclick="return loadMoreFeed('convoFeed');" value=" " class="seemorecom" />
	                        </div>
						#{/if}
                        <div class="cb"></div>
                      </div>
                      
                      #{if communityFeed}
                      	<div class="topic">
	                        <div class="newpage1"><a href="@{Home.conversationFeed()}">Breast Cancer Community Feed</a></div>
	                        <div class="topicborder"></div>
	                        <div class="cb"></div>
	                      </div>
	                      <div class="topic">
	                        <div id="communityFeedList">
		                    	#{list items: communityFeed, as: 'activity'}
									#{feedActivity activity: activity, talker: talker /}
								#{/list}
							</div>
							#{if communityFeed.size() == logic.FeedsLogic.FEEDS_PER_PAGE }
								<div class="replytommentbox" id="communityFeedBtn">
		                          <input type="submit" src="images/seemore.jpg" 
		                          	onclick="return loadMoreFeed('communityFeed');" value=" " class="seemorecom" />
		                        </div>
							#{/if}
	                        <div class="cb"></div>
	                      </div>
                      #{/if}
                      <!--topic-->
                      <div class="cb"></div>
                    </div>
                    <!--newpageCover-->
                    <div class="cb"></div>
                  </div>
                  <!--topic-->
                  <div class="cb"></div>
                </div>
                <!--topipcWraper-->
                <div class="cb"></div>
              </div>
              <!--mtcontent-->
              <div class="cb"></div>
            </div>
            <!--mtleft-->
            
            #{ set currentPage = 'home' /}
            #{ include 'right.html' /}
            
            <!--mtright-->
            <div class="cb"></div>
          </div>
          <!--mtcover-->
          <div class="cb"></div>

        </div>
        <div id="signupright"></div>
      </div>
    </div>
  </div>


<div id="boxes">
  <div id="dialog" class="window"> </div>
  
  #{popups/startConvo page: 'home' /}
  
  #{popups/imSettings /}
	
  <!-- Mask to cover the whole screen -->
  <div id="mask"></div>
</div>