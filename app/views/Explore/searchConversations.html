#{ extends 'main.html' /}

<link rel="stylesheet" href="/public/plugins/ui-lightness/jquery-ui-1.8.4.custom.css" type="text/css" media="screen" />
<script type="text/javascript" 
	src="/public/javascripts/jquery-ui-1.8.4.custom.min.js" ></script>
	
	<script type="text/javascript"> 	 
		$(document).ready(function() {
			makeAutocomplete("#query", "convo");

			$(".followConvoLink").live('click', function() {
				var topicId = $(this).attr("rel");
				if ($(this).html().indexOf("Unfollow") != -1) {
					$(this).html("Follow");
				}
				else {
					$(this).html("Unfollow");
				}
				$.post("@{Conversations.follow()}", 
	  				{ topicId: topicId},
	  				function(data) {
	  					//...
	  				}
	  			);
	  			return false;
			});
		});
   	</script>
	<style>
		body {
			background:url(/public/images/inner_bg.gif) repeat-x top;
			font-family:arial;
			font-size:11px;
		}
	</style>
</head>
<body>
	#{include 'header.html' /}
	<div id="innerbanner"></div>
	<div id="innermain">
		<div class="blacktext2" id="innerheading">Search Conversations</div>
		<div id="innermiddlearea">
           	<form name="searchForm" action="@{Explore.searchConversations()}" method="POST">
				<div id="searcharea">
					<input id="query" name="query" type="text" class="search"  value="${flash.query ? flash.query : 'Search Conversations'}" 
						onclick="if (this.value == 'Search Conversations') this.value=''" onblur=""/>
				</div>
				<div id="searchright">
					<a href="#" onclick="document.searchForm.submit(); return false;">
						<img src="/public/images/searchbutton.gif" width="34" height="35" border="0"/>
					</a>
				</div>
			</form>
			
			#{if results }
				<div class="activitiestext" style="font-size: 14px; clear: left">		
					#{list items:results, as: '_convo'}
						<div class="joinbox">
							<div class="joinpic">
								#{talker/talkerImageLink size: 48, userName: _convo.talker.userName /}
							</div>
							<div class="jointxtbox">
								<div class="jointextstop">
									<a href="@{ViewDispatcher.view(_convo.mainURL)}">${_convo.topic}</a>
								</div>
								<div class="joinztextlink">
									<a href="@{ViewDispatcher.view(_convo.mainURL)}#answers">${_convo.comments.size()} answer(s)</a> | 
									#{if session.username}
										<a href="#" class="followConvoLink" rel="${_convo.id}">
											${talker?.followingConvosList?.contains(_convo.id) ? 'Unfollow' : 'Follow'}</a>&nbsp;| 
										<a href="#" onclick="restartConvo(${_convo.tid}, '${_convo.id}')">Re-start talk</a> | 
									#{/if}
									<span>${_convo.creationDate.since()}</span>
								</div>
								<div class="jointxtlink1" style="font-weight: normal;">
									#{if _convo.searchFragment }
				        				<p>
				        					...${_convo.searchFragment.raw()}
				        				</p>
				        			#{/if}
				        			#{elseif _convo.comments.size() > 0 }
				        				<p>
				        					#{set topAnswer = _convo.comments.get(0) /}
					        				<span class="blacktext14">Top Answer by: ${topAnswer.fromTalker.userName}</span><br/>
					        				<span class="blacktext12">${topAnswer.text}</span>
					        			</p>
				        			#{/elseif}
								</div>
							</div>
							<div class="cb"></div>
							<div class="joinborder"></div>
						</div>
						*{
						<div class="area">
							<div class="arealeft2">
								<a href="@{ViewDispatcher.view(convo.talker.userName)}" class="bluetext11">
									<img src="@{Image.show(convo.talker.userName)}" width="71" height="71" border="0" />
									<br /><span class="bluetext11">${convo.talker.userName}</span>
								</a>
					  			<br/>
					  			<span class="blacktext11">${convo.talker.levelOfRecognition}</span>
					  		</div>
							<div class="arearight">
							    <div class="areatop"></div>
							    <div class="areamid">
							    	<div class="areamidleft">
							    		<p>
							    			<span class="blacktext14">
							    				<a href="@{ViewDispatcher.view(convo.mainURL)}">${convo.topic}</a><br />
							    				<span class="blacktext12">${convo.comments.size()} answer(s)</span> | 
					        					<span class="blacktext12">${convo.members.size()} people spoke</span> | 
					        					<a href="@{ViewDispatcher.view(convo.mainURL)}#comments" class="bluetext12">Comment</a> | 
					        					<a href="#" class="bluetext12 followTopicLink" rel="${convo.id}">
												${ talker?.followingConvosList?.contains(convo.id) ? 'Unfollow' : 'Follow'}
												</a> | 
												<a href="#" class="bluetext12 restartTopicLink" 
													rel="${convo.id}" rel2="${convo.tid}">Re-start</a> | 
					        					<span class="blacktext12">${convo.creationDate.since()}</span>
					        				</span>
					        			</p>
					        			#{if convo.searchFragment }
					        				<p>
					        					...${convo.searchFragment.raw()}
					        				</p>
					        			#{/if}
					        			#{elseif convo.comments.size() > 0 }
					        				<p>
					        					#{set topAnswer = convo.comments.get(0) /}
						        				<span class="blacktext14">Top Answer by: ${topAnswer.fromTalker.userName}</span><br/>
						        				<span class="blacktext12">${topAnswer.text}</span>
						        			</p>
					        			#{/elseif}
					        		</div>
								</div>
				  				<div class="areabot"></div>
				 	 		</div>
						</div>	
						}*	
					#{/list}
					#{else}
						No results.
					#{/else}
				</div>
			#{/if}
		</div>
	</div>