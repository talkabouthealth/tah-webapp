#{extends 'main.html' /}

<style>
	body { background:transparent url(/public/images/inner_bgmt.gif) repeat-x scroll center top; }
	#innerpersonalarea { padding-top: 10px }
	
	#mtright { margin-top:-50px; }
	#signupright { margin-right:43px; }
</style>
<script type="text/javascript" charset="utf-8">

	$(document).ready(function() {
		makeTopicsAutocomplete("#talkerkeywords");
	});
	
	function validatePasswordForm() {
		var reason = "";
		
		reason += validatePassword(document.changePasswordForm.newPassword);
		if (reason != "") {
		    alert(reason);
		    return false;
		}
		
		document.changePasswordForm.submit();
	}
	
	function validateProfileForm() {
	  var reason = "";
	  var updateprofileForm = document.getElementById("updateprofile");
		
	  reason += validateUsername(document.getElementById("talker.userName"));
	  //reason += validateEmail(document.getElementById("talker.email"));
	  //reason += validateEmpty(document.getElementById("talker.dobString"));
	    
	  if (reason != "") {
	    alert("Some fields need correction:\n" + reason);
	    return false;
	  }
		
	  updateprofileForm.submit();
	}
	function validateEmpty(fld) {
	    var error = "";
	 
	    if (fld.value.length == 0) {
	        fld.style.background = 'Yellow'; 
	        error = "The required field has not been filled in.\n"
	    } else {
	        fld.style.background = 'White';
	    }
	    return error;  
	}
	function validateUsername(fld) {
	    var error = "";
	    var illegalChars = /\W/; // allow letters, numbers, and underscores
	 
	    if (fld.value == "") {
	        fld.style.background = 'Yellow'; 
	        error = "You didn't enter a username.\n";
	    } else if ((fld.value.length < 1) || (fld.value.length > 15)) {
	        fld.style.background = 'Yellow'; 
	        error = "The username is the wrong length.\n";
	    } else if (illegalChars.test(fld.value)) {
	        fld.style.background = 'Yellow'; 
	        error = "The username contains illegal characters.\n";
	    } else {
	        fld.style.background = 'White';
	    }
	    return error;
	}
	function validatePassword(fld) {
	    var error = "";
	    var illegalChars = /[\W_]/; // allow only letters and numbers 
	 
	    if (fld.value == "") {
	        fld.style.background = 'Yellow';
	        error = "You didn't enter a password.\n";
	    } else if ((fld.value.length < 1) || (fld.value.length > 15)) {
	        error = "The password is the wrong length. \n";
	        fld.style.background = 'Yellow';
	    } else if (illegalChars.test(fld.value)) {
	        error = "The password contains illegal characters.\n";
	        fld.style.background = 'Yellow';
	    } else if (!((fld.value.search(/(a-z)+/)) && (fld.value.search(/(0-9)+/)))) {
	        error = "The password must contain at least one numeral.\n";
	        fld.style.background = 'Yellow';
	    } else {
	        fld.style.background = 'White';
	    }
	   return error;
	}  
	function trim(s)
	{
	  return s.replace(/^\s+|\s+$/, '');
	}
	function validateEmail(fld){
	    var error="";
	    var tfld = trim(fld.value);                        // value of field with whitespace trimmed off
	    var emailFilter = /^[^@]+@[^@.]+\.[^@]*\w\w$/ ;
	    var illegalChars= /[\(\)\<\>\,\;\:\\\"\[\]]/ ;
	   
	    if (fld.value == "") {
	        fld.style.background = 'Yellow';
	        error = "You didn't enter an email address.\n";
	    } else if (!emailFilter.test(tfld)) {              //test email for illegal characters
	        fld.style.background = 'Yellow';
	        error = "Please enter a valid email address.\n";
	    } else if (fld.value.match(illegalChars)) {
	        fld.style.background = 'Yellow';
	        error = "The email address contains illegal characters.\n";
	    } else {
	        fld.style.background = 'White';
	    }
	    return error;
	}

</script>
</head>
<body>
#{include 'header.html' /}
	<div id="innerbanner"></div>
	<div id="innermain">
		<div class="blacktext2" id="innerheading">Edit Your Profile Information</div>
		<div id="innerpersonalarea">
			<div id="signupleft">
#{if verifiedEmail}
<div id="verifiedEmailHelp" class="helpInfo">
      <div class="popboxWraper">
        <div class="popbox2">
          <div class="closecover" style="clear: none; float: right;">
            <div class="close" onclick="return hideHelpInfo('verifiedEmail', false);">
            	<img src="/public/images/close.jpg" alt="Close" /></div>
          </div>
          <div class="note">
          	#{if talker.isProf()}
          		<strong>Email verified successfully.  Thank you.</strong><br/><br/>
				Please tell us more about you so that we can personalize your experience and recommend topics and conversations. 
				As well, this enables community members to find you and follow your answers and comments if you choose.  
				Providing profile information is optional.
          	#{/if}
          	#{else}
          		<strong>Email verified successfully. Thank you.</strong><br/><br/>
			  	Please tell us more about you so that we can match you for conversations most relevant to you.
			  	Also, other community members with similar concerns can find and connect with you.
          	#{/else}
		  	<br/>
		  	<br/>
          </div>
          <div class="cb"></div>
        </div>
        <!--popbox2-->

      </div>
      <div class="cb"></div>
</div> 	
#{/if}			
#{ifnot talker?.hiddenHelps.contains('profile') }
<div id="profileHelp" class="helpInfo">
      <div class="popboxWraper">
        <div class="popbox2">
          <div class="closecover" style="clear: none; float: right;">
            <div class="close" onclick="return hideHelpInfo('profile', true);">
            	<img src="/public/images/close.jpg" alt="Close" /></div>
          </div>
          <div class="note">
          	#{if talker.isProf()}
          		<strong>Why provide profile information?</strong><br/>
				- We can personalize your experience and recommend topics and conversations most relevant to you.<br/>
				- Enables community members to find you based on location, health concerns, specialty, etc.<br/>
				- The more information everyone in the community shares, the more we help each other.<br/>
				<br/>
				<strong>Username visibility.</strong><br/>
				Your username will be visible to other members. 
				If you want to remain anonymous, please make your username different than your real name.<br/>
				<br/>
				<strong>Is the other profile information I provide private?</strong><br/>
				Yes. By default, the information you provide is private, including your photo. 
				You may make your profile viewable to the community by changing you <a href="@{Profile.preferences()}">Privacy Settings</a>.
          	#{/if}
          	#{else}
          		<strong>Why provide profile information?</strong><br/>
			  	- We can match you for questions and talks most relevant to you.<br/>
			  	- Enables other members with similar concerns to find and connect with you.<br/>
			  	- The more information everyone in the community shares, the more we help each other.<br/>
			  	<br/>
			  	<strong>Username visibility.</strong><br/>
			  	Your username will be visible to other members. 
			  	If you want to remain anonymous, please make your username different than your real name.<br/>
			  	<br/>
			  	<strong>Is the other profile information I provide private?</strong><br/>
			  	Yes. By default, the information you provide is private.
			  	You may make your profile viewable by the community by changing your <a href="@{Profile.preferences()}">Privacy Settings</a>.
          	#{/else}
		  	<br/>
		  	<br/>
          </div>
          <div class="cb"></div>
        </div>
        <!--popbox2-->

      </div>
      <div class="cb"></div>
</div> 
#{/ifnot}
			#{form @Profile.save() , id:'updateprofile' }
				<!-- We need this field to pass TalkerBean validation -->
				<input type="hidden" id="talker.password" name="talker.password" value="pass" />
				<div id="personalleft">
					<div class="personalmain" style="text-align: center">
						#{if "editForm".equals(flash.currentForm)}
							#{if flash.success}
							    <span class="success">Changes saved!</span>&nbsp;&nbsp;&nbsp;
							    <span style="font-size: 14px; font-weight: bold;">Next step: Edit your 
							    	<a href="@{Profile.healthDetails()}">Health Info</a>
							    </span>
							#{/if}
							#{ifErrors}
							   #{errors}
							       <span class="error">${error}</span><br/>
							   #{/errors}
							#{/ifErrors}
						#{/if}
					</div>
					<div class="personalmain">
						<div class="personaltextarea"><span class="blacktext14">Username</span></div>
						<div class="personaltextfield">
							<input name="talker.userName" type="text" class="personalfields" id="talker.userName" 
									value="${talker.userName}" />
						</div>
					</div>
					<input name="talker.email" type="hidden" class="personalfields" 
						id="talker.email" value="bad@email.com" />
					
					#{if models.TalkerBean.PROFESSIONAL_CONNECTIONS_LIST.contains(talker.connection)}
						#{include 'Profile/editfieldsProf.html' /}
					#{/if}
					#{else}
						#{include 'Profile/editfields.html' /}					
					#{/else}
					
					
				</div>
				<div id="personalright">
					<div id="personalrightimg">
						<img src="@{Image.show(talker.userName)}" />
					</div>
					<div class="bluetext12" id="personalrighttext">
						<a href="@{Profile.image()}" class="bluetext12">Change Photo</a>
					</div>
				</div>
			#{/form}
			</div>
			
			#{ set currentPage = 'publicProfile' /}
			#{ set currentTalker = talker /}
            #{ include 'PublicProfile/profileRight.html' /}
			
			<div id="signupright">
				<div class="personalinfosignrightbox">
					<div class="personalinfosignrighttop"></div>
					<div class="signrighmid">
						<span class="blacktext14"><strong>Picture and username visibility</strong></span>
						<span class="blacktext12"><br />
						Your picture and username will be visible to other members. 
						If you want to remain anonymous, please make your user name 
						different than your real name and do not use a picture of yourself.
						</span>
						<span class="blacktext14"><strong><br /><br />Why provide more information?</strong></span>
						<span class="blacktext12"><br />
							#{if talker.isProf()}
				          		Providing your profile information enables us to personalize your experience 
				          		and recommend topics and conversations most relevant to you.<br/><br/>
				          		The more information everyone in the community shares, the more we help each other.
				          	#{/if}
				          	#{else}
				          		Filling in your profile information enables us to match you with 
								questions and talks most relevant to you. <br/><br/>
								The more information you provide, the more likely other members with similar concerns will find and connect with you.
								<br /><br />
								The more information everyone in the community shares, the more we help each other.
				          	#{/else}
						</span>
						<span class="blacktext14"><strong><br />
						<br />Is the information I provide private?</strong></span>
						<span class="blacktext12"><br />
						By default, the information you provide is private. 
						You can make your information viewable to the community 
						by changing your <a href="@{Profile.preferences()}">Privacy Settings</a>.</span></span><br />
						<br />
					</div>
					<div class="signrighbot"></div>
				</div>
			</div>	
		</div>
	</div>
</div>
<div id="personalarea">
	<div id="personalinner">
		<div id="personalleft1">
		<a name="passwordform"></a>
		<form id="changePasswordForm" name="changePasswordForm" action="@{Profile.changePassword()}#changePasswordForm" method="post">
			<div class="personalmain" style="text-align: center">
				#{if "changePasswordForm".equals(flash.currentForm)}
					#{if flash.success}
					    <span class="success">Password is changed!</span>
					#{/if}
					#{ifErrors}
					   #{errors}
					       <span class="error">${error}</span><br/>
					   #{/errors}
					#{/ifErrors}
				#{/if}
			</div>
			<div class="personalmain">
				<div class="personaltextarea"><span class="blacktext14">Current Password</span></div>
				<div class="personaltextfield">
					<input name="curPassword" id="curPassword" type="password" class="personalfields" value="" />
				</div>
			</div>
			<div class="personalmain">
				<div class="personaltextarea"><span class="blacktext14">New Password</span></div>
				<div class="personaltextfield">
					<input name="newPassword" id="newPassword" type="password" class="personalfields" value="" />
				</div>
			</div>
			<div class="personalmain">
				<div class="personaltextarea"><span class="blacktext14">Confirm Password</span></div>
				<div class="personaltextfield">
					<input name="confirmPassword" id="confirmPassword" type="password" class="personalfields" value="" />
				</div>
			</div>
			<div class="personalmain">
				<div class="personaltextarea"></div>
				<div class="personaltextarea" style="height:46px; padding-top:2px;">
					<a href="#passwordform" onclick="validatePasswordForm()">
						<img src="/public/images/changepass_btn.gif" width="186" height="46" border="0" />
					</a>
				</div>
			</div>
		</form>
		</div>
	</div>
</div>
