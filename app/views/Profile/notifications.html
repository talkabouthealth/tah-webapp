#{ extends 'main.html' /}

<style>
	body { background:transparent url(/public/images/inner_bgmt.gif) repeat-x scroll center top; }
	#innerpersonalarea { padding-top: 10px; padding-bottom: 10px;}
	#innermiddlearea { width: 655px }
	#innerheading { width:500px; }
	
	#mtright { float: right; margin-top:-50px; }
	#signupright { margin-right:40px; }
	
	.button { position: relative; width: 600px; }
	.savednote {
		left:210px;
		position:absolute;
		top:14px;
	}
	
	.note {
		float: left; 
		clear: left; 
		margin-top: -10px; 
		width: 600px;
		color:#7C7C7C;
		font-family:arial;
		font-size:12px;
	}
	
	#emailstable td, #imstable td {
		padding: 7px;
		font-size: 14px;
	}
	.notiblueareamid, .signfields2 {
		background: none;
		border: none;
	}
</style>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		// ------------ Emails --------------
		$(".verificationResendLink").live("click", function() {
			$(this).html("Sending...");
			var email = $(this).attr("title");
			var verificationLink = $(this);
			var verificationResult = $(this).next("span");
			$.post("@{Profile.resendVerificationEmail()}", 
				{email: email},
				function(data) {
					verificationLink.hide();
					verificationResult.html(data).show();
				}
			);
			return false;
		});

		$("#newEmailBtn").click(function() {
			$("#emailError").html("");
			var newEmail = $("#newEmail").val();
			$.post("@{Profile.addEmail()}", 
				{newEmail : newEmail},
				function(data) {
					if (data.indexOf("<tr>") == 0) {
						$("#newEmail").val("");
						$("#addEmailForm").hide();

						$(data).appendTo($("#emailstable"));
					}
					else {
						$("#emailError").html(data);
					}
				}
			);
		});

		$(".makePrimaryLink").live("click", function() {
			var email = $(this).attr("title");
			$("#newPrimaryEmail").val(email);

			$("#changePrimaryForm").submit();
		});

		$(".deleteEmailLink").live("click", function() {
			var email = $(this).attr("title");
			//remove raw in the table
			$(this).parent().parent().remove();
			$.post("@{Profile.deleteEmail()}", 
				{email : email},
				function(data) {
					
				},
				"json"
			);
		});

		// ------------ IM Accounts --------------
		$("#newIMBtn").click(function() {
			$("#imError").html("");
			var imUserName = $("#imUserName").val();
			var imService = $("#imService").val();

			if (imService.length == 0) {
				alert("Please choose IM Service");
				return;
			}
			
			if (imUserName.length == 0) {
				alert("Please enter correct IM Username");
				return;
			}

			$.post("@{Profile.addIMAccount()}", 
				{imUserName : imUserName, imService : imService},
				function(data) {
					if (data.indexOf("<tr>") == 0) {
						$("#imUserName").val("");
						$("#imService").val("");
						$("#addIMForm").hide();

						$(data).appendTo($("#imstable"));
					}
					else {
						$("#imError").html(data);
					}
				}
			);
		});

		$(".deleteIMLink").live("click", function() {
			var imId = $(this).attr("rel");
			//remove raw in the table
			$(this).parent().parent().remove();
			$.post("@{Profile.deleteIMAccount()}", 
				{imId : imId},
				function(data) {}
			);
		});
	});
</script>

</head>

<body>
	#{include 'header.html' /}
	<div id="innerbanner"></div>
	<div id="innermain">
	<form id="changePrimaryForm" action="@{Profile.makePrimaryEmail()}" method="POST">
		<input type="hidden" id="newPrimaryEmail" name="newPrimaryEmail" />
		<div class="blacktext2" id="innerheading">Accounts where we notify you</div>
		<div id="innermiddlearea">
			<div class="notifactionboxtop"></div>
			<div class="notifactionboxmid">
				<div class="notibluearea">
					<div class="signfields2">
						<h1>Email</h1>
						<table id="emailstable" border="0">
							<tr>
								<td>${talker.email}<br/>
									#{if talker.verifyCode != null }
										<a href="#" title="${talker.email}"
											class="red12 verificationResendLink">(email not verified - resend verification e-mail)</a>
										<span id="verificationResendResult" class="blacktext12"></span>
									#{/if}
								</td>
								<td>Primary</td>
								<td>&nbsp;</td>
							</tr>
							#{list items: talker.emails, as: 'email' }
								#{ profileNotificationEmail email: email /}
							#{/list}
						</table>
						<a href="#"  style="font-size:14px;" 
							onclick="$('#addEmailForm').toggle(); return false;">add another email address</a>
						<div id="addEmailForm" style="display:none">
							<br/>
							<span class="error" id="emailError"></span><br/>
							<input id="newEmail" name="newEmail" type="text" value="" size="40"/>
							<br/>
							<input id="newEmailBtn" type="button" value="Add email" />
						</div>
					</div>
				</div>
				<div class="notibluearea">
					<div class="signfields2">
						<h1>IM</h1>
						<table id="imstable" border="0">
							#{list items: talker.imAccounts, as: 'imAccount' }
								#{ profileNotificationIM imAccount: imAccount /}
							#{/list}
						</table>
						<a href="#" style="font-size:14px;"
							onclick="$('#addIMForm').toggle(); return false;">add another IM account</a>
						<div id="addIMForm" style="display:none">
							<br/>
							<span class="error" id="imError"></span><br/>
							<select id="imService" name="imService" class="personalfields">
						  		<option selected value=''>Select an IM service</option>
								#{list items: models.IMAccountBean.IM_SERVICES_MAP.keySet(), as:'imService'}
								    <option value="${imService}" 
								    #{if flash['talker.im'].equals(imService) } selected #{/if} 
								    >${models.IMAccountBean.IM_SERVICES_MAP.get(imService)}</option>
								#{/list}
							</select>
							<br/>
							<input id="imUserName" name="imUserName" type="text" value="" size="40"/>
							<br/>
							<input id="newIMBtn" type="button" value="Add IM account" />
						</div>
					</div>
				</div>
			</div>
			<div class="notifactionboxbot"></div>
		</div>
	</form>
		
		#{ set currentPage = 'publicProfile' /}
		#{ set currentTalker = talker /}
        #{ include 'PublicProfile/profileRight.html' /}
            	
	
	<form id="NofifyFrequency" name="setNotifyFrequency" action="@{Profile.saveNotifications()}#notificationsform" method="post"  >
		<div class="blacktext2" id="innerheading">
			IM Notification Settings
		</div>
		<div id="innermiddlearea">
			<div class="notifactionboxtop"></div>
				<div class="notifactionboxmid">
					<div class="notibluearea">
						<div class="notiblueareamid">
							<h1>How often do you want to be notified?</h1>
							<ul>
	#{list items:['more than 10 times per day', '5 to 10 times per day', '2 to 5 times per day', '1 time per day', 'Never'], as:'notifyFreq'}
		<li>
			<input name="talker.nfreq" type="radio" value="${notifyFreq_index}" 
			#{if talker.nfreq == notifyFreq_index} checked="true" #{/if}
			class="radiobutton" /> 
			<span class="blacktext" style="vertical-align:top;">${notifyFreq}</span>
		</li>
	#{/list}
							</ul>
						</div>
					</div>
					<a name="notificationsform"></a>
					<div class="notibluearea">
						<div class="notiblueareamid">
							<h1>When do you want to be notified?</h1>
							<ul>
		 	#{list items:['whenever I am online', 'weekdays (9AM - 5PM)', 'weeknights (5PM - 10PM)', 'weekends (Sat and Sun)'], as:'notifyTime'}
				<li>
					<input name="talker.ntime" type="radio" value="${notifyTime_index}" 
					#{if talker.ntime == notifyTime_index} checked="true" #{/if}
					class="radiobutton" /> 
					<span class="blacktext" style="vertical-align:top;">${notifyTime}</span>
				</li>
			#{/list}
							</ul>
						</div>
					</div>
					<div class="notibluearea">
						<div class="notiblueareamid">
							<h1>What types of conversations interest you the most?</h1>
							<ul>	
						#{list items:["Informational", "Advice and opinions", "Meet new people", "Emotional support"], as:'cType'}
							<li><input name='talker.ctype' type='checkbox' value='${cType}' 
							#{if talker.ctype?.contains(cType) } checked="checked" #{/if}
							/>&nbsp;<span class='blacktext' >${cType}</span></li>
						#{/list}				
								<li>
									<textarea class="textarea3" rows="5" cols="45" style="padding: 5px; border: 1px solid #999999;"
										onclick="if (this.value == 'Other (please separate by commas)') this.value='';" 
										id="otherCTypes" name="otherCTypes">${talker.getOtherCTypes()}</textarea>
								</li>	
							</ul>
						</div>
					</div>
<!-- <div id="savebutton"><a href="/tah-java/SetNotification"><img src="/public/images/save.gif" width="186" height="46" /></a></div> -->
					<div class="button">
						<input id="submit" name="submit1" type="image" src="/public/images/save.gif" value="save changes"> 
						#{if "notificationsForm".equals(flash.currentForm)}
							#{if flash.success}
								<span class="success savednote">
									Changes saved!<br/>
									<span style="color: black; font-weight: bold;">
										Next step: Update your email settings below.
									</span>
								</span>
							#{/if}
						#{/if}
					</div>
				</div>
				<div class="notifactionboxbot"></div>
			</div>
		</form>
		
	<form id="emailsettings" name="emailsettings" action="@{Profile.saveEmailSettings()}#emailsettingsform" method="post">
		<div class="blacktext2" id="innerheading">
			<a name="emailsettingsform"></a>
			Email Settings
		</div>
		<div id="innermiddlearea">
			<div class="notifactionboxtop"></div>
			<div class="notifactionboxmid">
					<div class="notibluearea">
						<div class="signfields2">
							<div class="generalcheck">
								<h1>User Related</h1>
								#{set showConvoTitle = true /}
								#{list items:models.TalkerBean.EmailSetting.values(), as:'setting' }
									#{if setting.toString().startsWith('CONVO') && showConvoTitle}
										<h1>Conversation Related</h1>
										#{set showConvoTitle = false /}
									#{/if}
									<div class="preferencescheck">
										<input type="checkbox" value="" name="${setting}"
											#{if talker.loadEmailSettings().contains(setting) } checked='checked' #{/if}
										/>
										<span class="blacktext14">&nbsp;${setting.description}</span>
									</div>
								#{/list}
							</div>
							
							
							<h1>Newsletter</h1>
							<div class="generalcheck">
								<div class="preferencescheck">
									<input id="talker.newsletter" name="talker.newsletter" 
										type="checkbox" #{if talker.newsletter} checked #{/if} /> 
									<span class="blacktext14">&nbsp;Send me the TalkAboutHealth newsletter.</span>
								</div>
							</div>
						</div>
					</div>
					<div class="button">
						<input id="submit" name="submit1" type="image" src="/public/images/save.gif" value="save changes">  
						#{if "emailsettingsForm".equals(flash.currentForm)}
							#{if flash.success}
								<span class="success savednote">
									Changes saved!<br/>
									<span style="color: black; font-weight: bold;">
										Next step: Update your <a href="@{Profile.edit()}">Profile</a> and
										<a href="@{Profile.healthDetails()}">Health</a> Information.
									</span>
								</span>
							#{/if}
						#{/if}
					</div>
				</div>
				<div class="notifactionboxbot"></div>
			</div>
	</form>	
		
	</div>			