#{ extends 'main.html' /}

	<style>
		body { background:transparent url(/public/images/inner_bgmt.gif) repeat-x scroll center top; }
		#innerpersonalarea { padding-top: 10px }
		
		#mtright { margin-top:-50px; }
		#signupright { margin-right:43px; }
		
		.signfields2 ul {
			padding-top: 0px;
		}
		.signfields2 ul li {
			background:none;
			font-size: 14px;
			line-height: 24px;
			height: 24px;
			padding: 0px;
			width:600px;
		}
		.button { position: relative }
		.savednote {
			left:200px;
			position:absolute;
			top:8px;
		}
		
		#savedHelp {
			display:none;
			margin:0 auto;
			position:fixed;
			top:0;
			left:50%;
			margin:0 auto 0 -200px;
			width:400px;
			height: 60px;
			z-index:1001;
			
			text-align: center;
			border-top: none;
			
			-moz-border-radius-bottomleft: 10px;
			-moz-border-radius-bottomright: 10px;
			border-bottom-left-radius: 10px;
			border-bottom-right-radius: 10px;
		}
		#savedHelp .note { margin-top: 15px }
		
		.button { display: none; }
	</style>
	
	<script type="text/javascript" src="/public/plugins/jquery.form.js" ></script>
	<script type="text/javascript">
		function submitForm(section) {
			$("#section").val(section);
			
			document.healthdetailsform.submit();
			return false;
		}

		$(document).ready(function() {
			$("#healthdetailsform input, #healthdetailsform select, #healthdetailsform textarea").change(function() {
				if (closeInterval) {
					window.clearInterval(closeInterval);
				}
				$("#savedHelp .note").html("Saving...");
				$("#savedHelp").fadeIn(300);
				
				$('#healthdetailsform').ajaxSubmit(options); 
				return false;
			});
		});

		var options = { 
		        //target:        '#output2',   // target element(s) to be updated with server response 
		        //beforeSubmit:  showRequest,  // pre-submit callback 
		        success:       showResponse  // post-submit callback 
		 
		        // other available options: 
		        //url:       url         // override for form's 'action' attribute 
		        //type:      type        // 'get' or 'post', override for form's 'method' attribute 
		        //dataType:  null        // 'xml', 'script', or 'json' (expected server response type) 
		        //clearForm: true        // clear all form fields after successful submit 
		        //resetForm: true        // reset the form after successful submit 
		 
		        // $.ajax options can be used here too, for example: 
		        //timeout:   3000 
		    }; 

		var lastElement;
		var closeInterval;
		function ajaxSubmitForm(elem) {
			if (closeInterval) {
				window.clearInterval(closeInterval);
			}
			$("#savedHelp .note").html("Saving...");
			$("#savedHelp").fadeIn(300);
			
			lastElement = elem;
			$('#healthdetailsform').ajaxSubmit(options); 
			
			return false;
		}
		
		function showResponse(responseText, statusText, xhr, $form)  {
			$("#savedHelp .note").html("Saved!"); 
			closeInterval = setInterval(function() { $("#savedHelp").fadeOut(200) }, 2500);
		} 
	</script>
</head>
<body>

<div id="savedHelp" class="popbox2">
	<div style="clear: none; float: right;" class="closecover">
		<div onclick="return hideHelpInfo('saved', false);" class="close">
			<img alt="Close" src="/public/images/close.jpg"/>
		</div>
	</div>
	<div class="note">
	  	Saving...
	</div>
</div>

#{include 'header.html' /}

		<div id="innerbanner"></div>
		<form id="healthdetailsform" name="healthdetailsform" action="@{Profile.saveHealthDetails()}" method="POST">
		<input type="hidden" name="section" id="section" />
		<div id="innermain">
			<div class="blacktext2" id="innerheading">Edit Your Health Information</div>
			<div id="innerpersonalarea">
				<div id="signupleft">
#{ifnot talker?.hiddenHelps.contains('health')}
<div id="healthHelp" class="helpInfo">
      <div class="popboxWraper">
        <div class="popbox2">
          <div class="closecover" style="clear: none; float: right;">
            <div class="close" onclick="return hideHelpInfo('health', true);">
            	<img src="/public/images/close.jpg" alt="Close" /></div>
          </div>
          <div class="note">
		  	<strong>Why provide health information?</strong><br/>
		  	- We can match you better for questions and talks most relevant to you.<br/>
		  	- Enables other members with similar concerns to find and connect with you.<br/>
		  	- The more information everyone in the community shares, the more we help each other.<br/>
		  	<br/>
		  	<strong>Is the health information I provide private?</strong><br/>
		  	Yes. By default, the information you provide is private. 
		  	You may make your information viewable to the community by changing your <a href="@{Profile.preferences()}">Privacy Settings.</a><br/>
		  	<br/>
          </div>
          <div class="cb"></div>
        </div>
        <!--popbox2-->

      </div>
      <div class="cb"></div>
</div> 
#{/ifnot}
					<div id="signupleftarea">
						<div class="signupmain">
							<div class="generaltextarea">
								<span class="blacktext16"><strong>Health Bio</strong></span>
							</div>
							<div class="textareabig">
								<textarea name="talkerDisease.healthBio" cols="45" rows="5" 
									class="textarea3">${talkerDisease?.healthBio}</textarea>
							</div>
						</div>
						#{list items:disease.questions, as:'question'}
							<div class="signupmain">
							#{if question.type == models.DiseaseBean.DiseaseQuestion.DiseaseQuestionType.SELECT}
								<div class="generaltextarea">
									<span class="blacktext16"><strong>${question.text}</strong></span>
								</div>
								<div class="personaltextfield">
									<select name="${question.name}" class="personalfields">
										<option value=""></option>
										#{list items:question.choices, as:'choice' }
											<option value="${choice}" 
										    	#{if talkerDisease?.healthInfo?.get(question.name)?.contains(choice) } 
										    		selected 
										    	#{/if}
										    >${choice}</option>
										#{/list}
									</select>
								</div>
							#{/if}
							#{else}
								<div class="generaltextarea2">
	 								<span class="blacktext16"><strong>${question.text}</strong></span>
	 							</div>
								<div class="generalcheck">
									#{list items:question.choices, as: 'choice'}
										<div>
											<input name="${question.name}" type="checkbox" value="${choice}"
											#{if talkerDisease?.healthInfo?.get(question.name)?.contains(choice) } 
									    		checked='checked'
									    	#{/if}
											/>&nbsp; <span class="blacktext14">${choice}</span>
										</div>
									#{/list}
								</div>
							#{/else}
						</div>
						#{/list}
						
						*{
						<div class="signupmain">
							<a name="symptoms"></a>
							<div class="generaltextarea">
								<span class="blacktext16"><strong>Stage of disease</strong></span>
							</div>
							<div class="personaltextfield">
								<select name="talkerDisease.stage" class="personalfields">
									#{list items:stagesList, as:'stage' }
										<option value="${stage}" 
									    #{if stage.equals(talkerDisease?.stage) } selected #{/if} 
									    >${stage}</option>
									#{/list}
								</select>
							</div>
						</div>
						<div class="signupmain">
							<div class="generaltextarea">
								<span class="blacktext16"><strong>Disease type</strong></span>
							</div>
							<div class="personaltextfield">
								<select name="talkerDisease.type" class="personalfields">
									#{list items:typesList, as:'type' }
										<option value="${type}" 
									    #{if type.equals(talkerDisease?.type) } selected #{/if} 
									    >${type}</option>
									#{/list}
								</select>
							</div>
						</div>
						}*
						
						<div class="signupmain">
							<a name="symptoms"></a>
							<div class="generaltextarea">
								<span class="blacktext16"><strong>Is it recurrent?</strong></span>
							</div>
							<div class="personaltextfield">
								<select name="talkerDisease.recurrent" class="personalfields">
									#{list items:['', 'no', 'yes'], as:'val' }
										<option value="${val}" 
									    #{if val.equals(talkerDisease?.recurrent) } selected #{/if} 
									    >${val}</option>
									#{/list}	
								</select>
							</div>
						</div>
						<div class="signupmain">
							<div class="generaltextarea">
								<span class="blacktext16"><strong>When did the first symptom appear?</strong></span>
							</div>
							<div class="personaltextfield">
								<select size="1"  name="talkerDisease.symptomMonth" id="talkerDisease.symptomMonth" class="textarea2">
#{list items:['Month', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], as:'i'}
    <option value="${i_index-1}" 
    #{if talkerDisease?.symptomDate?.month == i_index-2 } selected #{/if} 
    >${i}</option>
#{/list}
								</select>
								&nbsp;  &nbsp;  &nbsp;&nbsp;  &nbsp;  &nbsp;
								<select size="1"  name="talkerDisease.symptomYear" class="textarea2" id="talkerDisease.symptomYear">
							  		<option value='0'>Year</option>
							  		#{list items:2010..1950, as:'i'}
									    <option value="${i}"
									    *{ TODO: use of deprecated getYear() ? }*
									    #{if talkerDisease?.symptomDate?.year == i - 1900 } selected #{/if} 
									    >${i}</option>
									#{/list}
								</select>
							</div>
						</div>
						<div class="signupmain">
							<div class="generaltextarea">
								<span class="blacktext16"><strong>When were you first diagnosed?</strong></span>
							</div>
							<div class="personaltextfield">
								<select size="1"  name="talkerDisease.diagnoseMonth" id="talkerDisease.diagnoseMonth" class="textarea2">
#{list items:['Month', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], as:'i'}
    <option value="${i_index-1}" 
    #{if talkerDisease?.diagnoseDate?.month == i_index-2 } selected #{/if} 
    >${i}</option>
#{/list}
								</select>
								&nbsp;  &nbsp;  &nbsp;&nbsp;  &nbsp;  &nbsp;
								<select size="1"  name="talkerDisease.diagnoseYear" class="textarea2" id="talkerDisease.diagnoseYear">
							  		<option value='0'>Year</option>
							  		#{list items:2010..1950, as:'i'}
									    <option value="${i}"
									    *{ TODO: use of deprecated getYear() ? }*
									    #{if talkerDisease?.diagnoseDate?.year == i - 1900 } selected #{/if} 
									    >${i}</option>
									#{/list}
								</select>
							</div>
						</div>
						
						<div class="signupmain">
 							<div class="generaltextarea2">
 								<span class="blacktext16"><strong>What were the initial symptoms you experienced?</strong></span>
 							</div>
							<div class="generalcheck">
								#{ healthItemsTree healthItem:healthItemsMap["symptoms"], checkedItems: talkerDisease?.healthItems /}
							</div>
							<div class="signupmain">
								<div class="textareabig">
									#{ otherField name:'symptoms', values: talkerDisease?.otherHealthItems /}
								</div>
							</div>
							<div class="button">
								<a href="" onclick="return submitForm('symptoms');">
									<img src="/public/images/savechanges_btn.gif" width="186" height="46" border="0" />
								</a>
								#{if flash.symptoms}
									<span class="success savednote">
										${flash.symptoms}<br/>
										<span style="color: black; font-weight: bold;">
											After entering your health info, the next <br/>
											step is to update your <a href="@{Profile.preferences()}">Privacy Settings</a>.
										</span>
									</span>
								#{/if}
							</div>
						</div>
						<div class="signupmain"></div>
					</div>
				</div>
				
				#{ set currentPage = 'publicProfile' /}
				#{ set currentTalker = talker /}
            	#{ include 'PublicProfile/profileRight.html' /}
            
				<div id="signupright">
					<div class="personalinfosignrightbox">
					<div class="personalinfosignrighttop"></div>
					<div class="signrighmid">
						<span class="blacktext14"><strong>Why provide your health information?</strong></span>
						<span class="blacktext12"><br />
						Filling in your health details enables us to match you with questions
						and talks most relevant to you.
						<br /><br />					 
						The more information you provide, the more likely 
						other members with similar concerns will find and connect with you.
						<br /><br />
						The more information everyone in the community shares, the more we help each other.
						</span>
						<span class="blacktext14"><strong><br />
						<br />Is the information I provide private?</strong></span>
						<span class="blacktext12"><br />
						Yes. The information you provide is private by default. 
						You may make your information viewable to the community 
						by changing your <a href="@{Profile.preferences()}">Privacy Settings.</a></span></span><br />
						<br />
					</div>
					<div class="signrighbot"></div>
				</div>
				</div>
			</div>
		</div>
		
		<div id="midnoticontainer">
			<div id="midnoticontainermain">
				<div id="boxarea_head2" class="blacktext2">Tests and Procedures</div>
				<div class="signupleftarea2">
					<div class="generalsubhead">Which of the following tests have you had?</div>
					<div class="generalcheck">
						#{ healthItemsTree healthItem:healthItemsMap["tests"], checkedItems: talkerDisease?.healthItems /}
					</div>
					<div class="textareabig">
						#{ otherField name:'tests', values: talkerDisease?.otherHealthItems /}
					</div>
					<div class="generalsubhead">
						<a name="procedures"></a>
						What procedures/surgeries have you had?
					</div>
					<div class="generalcheck">
						#{ healthItemsTree healthItem:healthItemsMap["procedures"], checkedItems: talkerDisease?.healthItems /}
					</div>
					<div class="textareabig">
						#{ otherField name:'procedures', values: talkerDisease?.otherHealthItems /}
					</div>
					<div class="button">
						<a href="" onclick="return submitForm('procedures');">
							<img src="/public/images/savechanges_btn.gif" width="186" height="46" border="0" />
						</a>
						#{if flash.procedures}
							<span class="success savednote">
								${flash.procedures}<br/>
								<span style="color: black; font-weight: bold;">
									After entering your health info, the next <br/>
									step is to update your <a href="@{Profile.preferences()}">Privacy Settings</a>.
								</span>
							</span>
						#{/if}
					</div>
					<div class="signupmain"></div>
				</div>
			</div>
		</div>
		
		<div id="midnoticontainer">
			<div id="midnoticontainermain">
				<div id="boxarea_head2" class="blacktext2">Treatments and medications</div>
				<div class="signupleftarea2">
					<div class="generalsubhead">
						What treatments / medications have you taken?
					</div>
					<div class="generalcheck">
						<a name="treatments"></a>
						#{ healthItemsTree healthItem:healthItemsMap["treatments"], checkedItems: talkerDisease?.healthItems /}
					</div>
					<div class="textareabig">
						#{ otherField name:'treatments', values: talkerDisease?.otherHealthItems /}
					</div>
					<div class="button">
						<a href="" onclick="return submitForm('treatments');">
							<img src="/public/images/savechanges_btn.gif" width="186" height="46" border="0" />
						</a>
						#{if flash.treatments}
							<span class="success savednote">
								${flash.treatments}<br/>
								<span style="color: black; font-weight: bold;">
									After entering your health info, the next <br/>
									step is to update your <a href="@{Profile.preferences()}">Privacy Settings</a>.
								</span>
							</span>
						#{/if}
					</div>
					<div class="signupmain"></div>
				</div>
			</div>
		</div>
		
		<div id="midnoticontainer">
			<div id="midnoticontainermain">
				<div id="boxarea_head2" class="blacktext2">Side Effects</div>
				<div class="signupleftarea2">
					<div class="generalsubhead">What Treatment/Medication Side Effects have you experienced?</div>
					<div class="generalcheck">
						#{ healthItemsTree healthItem:healthItemsMap["sideeffects"], checkedItems: talkerDisease?.healthItems /}
					</div>
					<div class="textareabig">
						<a name="sideeffects"></a>
						#{ otherField name:'sideeffects', values: talkerDisease?.otherHealthItems /}
					</div>
					<div class="button">
						<a href="" onclick="return submitForm('sideeffects');">
							<img src="/public/images/savechanges_btn.gif" width="186" height="46" border="0" />
						</a>
						#{if flash.sideeffects}
							<span class="success savednote">
								${flash.sideeffects}<br/>
								<span style="color: black; font-weight: bold;">
									After entering your health info, the next <br/>
									step is to update your <a href="@{Profile.preferences()}">Privacy Settings</a>.
								</span>
							</span>
						#{/if}
					</div>
					<div class="signupmain"></div>
				</div>
			</div>
		</div>
	</form>